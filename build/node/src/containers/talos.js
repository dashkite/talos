"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Talos = void 0;
var Meta = _interopRequireWildcard(require("@dashkite/joy/metaclass"));
var Type = _interopRequireWildcard(require("@dashkite/joy/type"));
var Value = _interopRequireWildcard(require("@dashkite/joy/value"));
var $ = _interopRequireWildcard(require("../internal/states.js"));
var _generic = require("@dashkite/joy/generic");
var _helpers = require("../helpers.js");
var _errors = require("./errors.js");
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
var Talos, create, isError, isState;
isState = (0, _helpers.oneOf)([Type.isString, Type.isSymbol]);
isError = (0, _helpers.oneOf)([Type.isUndefined, _errors.TalosError.isType]);
create = (0, _generic.generic)({
  name: "talos create",
  default: function (...args) {
    throw new Error(`Talos.create: input is malformed ${JSON.stringify(args)}`);
  }
});
(0, _generic.generic)(create, isState, Type.isObject, isError, function (state, context, error) {
  return new Talos({
    state,
    context,
    error
  });
});
(0, _generic.generic)(create, function () {
  return create($.start, {}, null);
});
(0, _generic.generic)(create, isState, Type.isObject, function (state, context) {
  return create(state, context, null);
});
(0, _generic.generic)(create, isState, function (state) {
  return create(state, {}, null);
});
(0, _generic.generic)(create, Type.isObject, function (context) {
  return create($.start, context, null);
});
exports.Talos = Talos = function () {
  class Talos {
    constructor({
      state: state1,
      context: context1,
      error: error1
    }) {
      this.state = state1;
      this.context = context1;
      this.error = error1;
    }
    halt() {
      return this.state = $.halt;
    }
    throw(error) {
      this.halt();
      return this.error = error != null ? error : _errors.TalosError.create();
    }
    reset(state) {
      this.state = state != null ? state : $.start;
      this.context = {};
      return this.error = null;
    }
    clone() {
      return create(Value.clone(this.state), Value.clone(this.context), this.error);
    }
  }
  ;
  Meta.mixin(Talos.prototype, [Meta.getters({
    starting: function () {
      return $.atStart(this.state);
    },
    halted: function () {
      return $.atHalt(this.state);
    },
    success: function () {
      return this.halted && this.error == null;
    },
    failure: function () {
      return this.halted && this.error != null;
    },
    running: function () {
      return !this.halted;
    }
  })]);
  Talos.create = create;
  Talos.isType = Type.isType(Talos);
  return Talos;
}.call(void 0);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jb250YWluZXJzL3RhbG9zLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBLElBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFDQSxJQUFBLElBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFDQSxJQUFBLEtBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFBQSxJQUFBLENBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFFQSxJQUFBLFFBQUEsR0FBQSxPQUFBO0FBQUEsSUFBQSxRQUFBLEdBQUEsT0FBQTtBQUFBLElBQUEsT0FBQSxHQUFBLE9BQUE7QUFBQSxTQUFBLHlCQUFBLENBQUEsNkJBQUEsT0FBQSxtQkFBQSxDQUFBLE9BQUEsT0FBQSxJQUFBLENBQUEsT0FBQSxPQUFBLFlBQUEsd0JBQUEsWUFBQSxDQUFBLENBQUEsV0FBQSxDQUFBLEdBQUEsQ0FBQSxHQUFBLENBQUEsS0FBQSxDQUFBO0FBQUEsU0FBQSx3QkFBQSxDQUFBLEVBQUEsQ0FBQSxTQUFBLENBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLFVBQUEsU0FBQSxDQUFBLGVBQUEsQ0FBQSx1QkFBQSxDQUFBLHlCQUFBLENBQUEsV0FBQSxPQUFBLEVBQUEsQ0FBQSxRQUFBLENBQUEsR0FBQSx3QkFBQSxDQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBLFVBQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBLE9BQUEsQ0FBQSxLQUFBLFNBQUEsVUFBQSxDQUFBLEdBQUEsTUFBQSxDQUFBLGNBQUEsSUFBQSxNQUFBLENBQUEsd0JBQUEsV0FBQSxDQUFBLElBQUEsQ0FBQSxvQkFBQSxDQUFBLElBQUEsTUFBQSxDQUFBLFNBQUEsQ0FBQSxjQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsRUFBQSxDQUFBLFNBQUEsQ0FBQSxHQUFBLENBQUEsR0FBQSxNQUFBLENBQUEsd0JBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxVQUFBLENBQUEsS0FBQSxDQUFBLENBQUEsR0FBQSxJQUFBLENBQUEsQ0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLGNBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBLE9BQUEsR0FBQSxDQUFBLEVBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQSxFQUFBLENBQUEsR0FBQSxDQUFBO0FBSkEsSUFBQSxLQUFBLEVBQUEsTUFBQSxFQUFBLE9BQUEsRUFBQSxPQUFBO0FBU0EsT0FBQSxHQUFVLElBQUEsY0FBQSxFQUFNLENBQ2QsSUFBSSxDQUFDLFFBRFMsRUFFZCxJQUFJLENBQUMsUUFGUyxDQUFOLENBQUE7QUFLVixPQUFBLEdBQVUsSUFBQSxjQUFBLEVBQU0sQ0FDZCxJQUFJLENBQUMsV0FEUyxFQUVkLGtCQUFVLENBQUMsTUFGRyxDQUFOLENBQUE7QUFLVixNQUFBLEdBQVMsSUFBQSxnQkFBQSxFQUNQO0VBQUEsSUFBQSxFQUFNLGNBQU47RUFDQSxPQUFBLEVBQVMsU0FBQSxDQUFBLEdBQUUsSUFBRixFQUFBO0lBQ1AsTUFBTSxJQUFJLEtBQUosQ0FBVSxvQ0FBb0MsSUFBSSxDQUFDLFNBQUwsQ0FBZSxJQUFuRCxDQUFBLEVBQVYsQ0FBQTtFQURDO0FBRFQsQ0FETyxDQUFBO0FBS1QsSUFBQSxnQkFBQSxFQUFRLE1BQVIsRUFBZ0IsT0FBaEIsRUFBeUIsSUFBSSxDQUFDLFFBQTlCLEVBQXdDLE9BQXhDLEVBQWlELFVBQUUsS0FBRixFQUFTLE9BQVQsRUFBa0IsS0FBbEIsRUFBQTtTQUMvQyxJQUFJLEtBQUosQ0FBVTtJQUFFLEtBQUY7SUFBUyxPQUFUO0lBQWtCO0VBQWxCLENBQVYsQ0FBQTtBQUQrQyxDQUFqRCxDQUFBO0FBR0EsSUFBQSxnQkFBQSxFQUFRLE1BQVIsRUFBZ0IsWUFBQTtTQUNkLE1BQUEsQ0FBTyxDQUFDLENBQUMsS0FBVCxFQUFnQixDQUFBLENBQWhCLEVBQW9CLElBQXBCLENBQUE7QUFEYyxDQUFoQixDQUFBO0FBR0EsSUFBQSxnQkFBQSxFQUFRLE1BQVIsRUFBZ0IsT0FBaEIsRUFBeUIsSUFBSSxDQUFDLFFBQTlCLEVBQXdDLFVBQUUsS0FBRixFQUFTLE9BQVQsRUFBQTtTQUN0QyxNQUFBLENBQU8sS0FBUCxFQUFjLE9BQWQsRUFBdUIsSUFBdkIsQ0FBQTtBQURzQyxDQUF4QyxDQUFBO0FBR0EsSUFBQSxnQkFBQSxFQUFRLE1BQVIsRUFBZ0IsT0FBaEIsRUFBeUIsVUFBRSxLQUFGLEVBQUE7U0FDdkIsTUFBQSxDQUFPLEtBQVAsRUFBYyxDQUFBLENBQWQsRUFBa0IsSUFBbEIsQ0FBQTtBQUR1QixDQUF6QixDQUFBO0FBR0EsSUFBQSxnQkFBQSxFQUFRLE1BQVIsRUFBZ0IsSUFBSSxDQUFDLFFBQXJCLEVBQStCLFVBQUUsT0FBRixFQUFBO1NBQzdCLE1BQUEsQ0FBTyxDQUFDLENBQUMsS0FBVCxFQUFnQixPQUFoQixFQUF5QixJQUF6QixDQUFBO0FBRDZCLENBQS9CLENBQUE7QUFHTSxPQUFBLENBQUEsS0FBQSxHQUFBLEtBQUEsR0FBQSxZQUFBO0VBQU4sTUFBQSxLQUFBLENBQUE7SUFDRSxXQUFhLENBQUM7TUFBRyxLQUFBLEVBQUEsTUFBSDtNQUFXLE9BQUEsRUFBQSxRQUFYO01BQXFCLEtBQUEsRUFBQTtJQUFyQixDQUFELEVBQUE7TUFBRyxJQUFDLENBQUEsS0FBQSxHQUFBLE1BQUE7TUFBTyxJQUFDLENBQUEsT0FBQSxHQUFBLFFBQUE7TUFBUyxJQUFDLENBQUEsS0FBQSxHQUFBLE1BQUE7SUFBdEI7SUFjYixJQUFNLENBQUEsRUFBQTthQUNKLElBQUMsQ0FBQSxLQUFELEdBQVMsQ0FBQyxDQUFDLElBQUE7SUFEUDtJQUdOLEtBQU8sQ0FBRSxLQUFGLEVBQUE7TUFDTCxJQUFDLENBQUEsSUFBRCxDQUFBLENBQUE7YUFDQSxJQUFDLENBQUEsS0FBRCxHQUFBLEtBQUEsSUFBQSxJQUFBLEdBQVMsS0FBQSxHQUFRLGtCQUFVLENBQUMsTUFBWCxDQUFBLENBQUE7SUFGWjtJQUlQLEtBQU8sQ0FBRSxLQUFGLEVBQUE7TUFDTCxJQUFDLENBQUEsS0FBRCxHQUFBLEtBQUEsSUFBQSxJQUFBLEdBQVMsS0FBQSxHQUFRLENBQUMsQ0FBQyxLQUFBO01BQ25CLElBQUMsQ0FBQSxPQUFELEdBQVcsQ0FBQSxDQUFBO2FBQ1gsSUFBQyxDQUFBLEtBQUQsR0FBUyxJQUFBO0lBSEo7SUFLUCxLQUFPLENBQUEsRUFBQTthQUNMLE1BQUEsQ0FBUyxLQUFLLENBQUMsS0FBTixDQUFZLElBQUMsQ0FBQSxLQUFiLENBQVQsRUFBaUMsS0FBSyxDQUFDLEtBQU4sQ0FBWSxJQUFDLENBQUEsT0FBYixDQUFqQyxFQUF5RCxJQUFDLENBQUEsS0FBMUQsQ0FBQTtJQURLO0VBM0JUO0VBQUE7RUFHRSxJQUFJLENBQUMsS0FBTCxDQUFXLEtBQUMsQ0FBQSxTQUFaLEVBQWdCLENBQ2QsSUFBSSxDQUFDLE9BQUwsQ0FDRTtJQUFBLFFBQUEsRUFBVSxTQUFBLENBQUEsRUFBQTthQUFHLENBQUMsQ0FBQyxPQUFGLENBQVUsSUFBQyxDQUFBLEtBQVgsQ0FBQTtJQUFILENBQVY7SUFDQSxNQUFBLEVBQVEsU0FBQSxDQUFBLEVBQUE7YUFBRyxDQUFDLENBQUMsTUFBRixDQUFTLElBQUMsQ0FBQSxLQUFWLENBQUE7SUFBSCxDQURSO0lBRUEsT0FBQSxFQUFTLFNBQUEsQ0FBQSxFQUFBO2FBQUcsSUFBQyxDQUFBLE1BQUQsSUFBWSxJQUFBLENBQUEsS0FBQSxJQUFBLElBQUE7SUFBZixDQUZUO0lBR0EsT0FBQSxFQUFTLFNBQUEsQ0FBQSxFQUFBO2FBQUcsSUFBQyxDQUFBLE1BQUQsSUFBVyxJQUFBLENBQUEsS0FBQSxJQUFBLElBQUE7SUFBZCxDQUhUO0lBSUEsT0FBQSxFQUFTLFNBQUEsQ0FBQSxFQUFBO2FBQUcsQ0FBQyxJQUFDLENBQUEsTUFBQTtJQUFMO0VBSlQsQ0FERixDQURjLENBQWhCLENBQUE7RUFTQSxLQUFDLENBQUEsTUFBRCxHQUFTLE1BQUE7RUFDVCxLQUFDLENBQUEsTUFBRCxHQUFTLElBQUksQ0FBQyxNQUFMLENBQVksS0FBWixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgTWV0YSBmcm9tIFwiQGRhc2hraXRlL2pveS9tZXRhY2xhc3NcIlxuaW1wb3J0ICogYXMgVHlwZSBmcm9tIFwiQGRhc2hraXRlL2pveS90eXBlXCJcbmltcG9ydCAqIGFzIFZhbHVlIGZyb20gXCJAZGFzaGtpdGUvam95L3ZhbHVlXCJcbmltcG9ydCAqIGFzICQgZnJvbSBcIi4uL2ludGVybmFsL3N0YXRlc1wiXG5pbXBvcnQgeyBnZW5lcmljIH0gZnJvbSBcIkBkYXNoa2l0ZS9qb3kvZ2VuZXJpY1wiXG5pbXBvcnQgeyBvbmVPZiB9IGZyb20gXCIuLi9oZWxwZXJzXCJcbmltcG9ydCB7IFRhbG9zRXJyb3IgfSBmcm9tIFwiLi9lcnJvcnNcIlxuXG5cbmlzU3RhdGUgPSBvbmVPZiBbXG4gIFR5cGUuaXNTdHJpbmdcbiAgVHlwZS5pc1N5bWJvbFxuXVxuXG5pc0Vycm9yID0gb25lT2YgW1xuICBUeXBlLmlzVW5kZWZpbmVkXG4gIFRhbG9zRXJyb3IuaXNUeXBlXG5dXG5cbmNyZWF0ZSA9IGdlbmVyaWMgXG4gIG5hbWU6IFwidGFsb3MgY3JlYXRlXCJcbiAgZGVmYXVsdDogKCBhcmdzLi4uICkgLT4gXG4gICAgdGhyb3cgbmV3IEVycm9yIFwiVGFsb3MuY3JlYXRlOiBpbnB1dCBpcyBtYWxmb3JtZWQgI3tKU09OLnN0cmluZ2lmeSBhcmdzfVwiXG5cbmdlbmVyaWMgY3JlYXRlLCBpc1N0YXRlLCBUeXBlLmlzT2JqZWN0LCBpc0Vycm9yLCAoIHN0YXRlLCBjb250ZXh0LCBlcnJvciApIC0+XG4gIG5ldyBUYWxvcyB7IHN0YXRlLCBjb250ZXh0LCBlcnJvciB9XG5cbmdlbmVyaWMgY3JlYXRlLCAtPlxuICBjcmVhdGUgJC5zdGFydCwge30sIG51bGxcblxuZ2VuZXJpYyBjcmVhdGUsIGlzU3RhdGUsIFR5cGUuaXNPYmplY3QsICggc3RhdGUsIGNvbnRleHQgKSAtPlxuICBjcmVhdGUgc3RhdGUsIGNvbnRleHQsIG51bGxcblxuZ2VuZXJpYyBjcmVhdGUsIGlzU3RhdGUsICggc3RhdGUgKSAtPlxuICBjcmVhdGUgc3RhdGUsIHt9LCBudWxsXG5cbmdlbmVyaWMgY3JlYXRlLCBUeXBlLmlzT2JqZWN0LCAoIGNvbnRleHQgKSAtPlxuICBjcmVhdGUgJC5zdGFydCwgY29udGV4dCwgbnVsbFxuXG5jbGFzcyBUYWxvc1xuICBjb25zdHJ1Y3RvcjogKHsgQHN0YXRlLCBAY29udGV4dCwgQGVycm9yIH0pIC0+XG5cbiAgTWV0YS5taXhpbiBAOjosIFtcbiAgICBNZXRhLmdldHRlcnNcbiAgICAgIHN0YXJ0aW5nOiAtPiAkLmF0U3RhcnQgQHN0YXRlXG4gICAgICBoYWx0ZWQ6IC0+ICQuYXRIYWx0IEBzdGF0ZVxuICAgICAgc3VjY2VzczogLT4gQGhhbHRlZCAmJiAhQGVycm9yP1xuICAgICAgZmFpbHVyZTogLT4gQGhhbHRlZCAmJiBAZXJyb3I/XG4gICAgICBydW5uaW5nOiAtPiAhQGhhbHRlZFxuICBdXG5cbiAgQGNyZWF0ZTogY3JlYXRlXG4gIEBpc1R5cGU6IFR5cGUuaXNUeXBlIEBcblxuICBoYWx0OiAtPlxuICAgIEBzdGF0ZSA9ICQuaGFsdFxuXG4gIHRocm93OiAoIGVycm9yICkgLT5cbiAgICBAaGFsdCgpXG4gICAgQGVycm9yID0gZXJyb3IgPyBUYWxvc0Vycm9yLmNyZWF0ZSgpXG5cbiAgcmVzZXQ6ICggc3RhdGUgKSAtPlxuICAgIEBzdGF0ZSA9IHN0YXRlID8gJC5zdGFydFxuICAgIEBjb250ZXh0ID0ge31cbiAgICBAZXJyb3IgPSBudWxsXG5cbiAgY2xvbmU6IC0+XG4gICAgY3JlYXRlICggVmFsdWUuY2xvbmUgQHN0YXRlICksICggVmFsdWUuY2xvbmUgQGNvbnRleHQgKSwgQGVycm9yXG4gICAgICBcblxuZXhwb3J0IHtcbiAgVGFsb3Ncbn0iXSwic291cmNlUm9vdCI6IiJ9
//# sourceURL=src/containers/talos.coffee