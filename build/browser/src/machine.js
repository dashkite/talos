var Edge, Edges, Machine, Vertex, areVertexEdges, isState, normalizeMove, normalizeWhen, prioritize;
import { generic } from "@dashkite/joy/generic";
import * as Type from "@dashkite/joy/type";
import { $start, $end } from "./states";
isState = function(x) {
    return Type.isString(x) || Type.isSymbol(x);
};
areVertexEdges = function(x) {
    var edge, j, len, ref;
    if (x.edges == null) {
        return false;
    }
    if (!Type.isArray(x.edges)) {
        return false;
    }
    ref = x.edges;
    for(j = 0, len = ref.length; j < len; j++){
        edge = ref[j];
        if (!Type.isObject(edge)) {
            return false;
        }
    }
    return true;
};
normalizeWhen = function(x) {
    if (isState(x)) {
        return function(talos, event) {
            return event === condition;
        };
    } else if (Type.isFunction(x)) {
        return x;
    } else if (Type.isBoolean(x)) {
        return function() {
            return x;
        };
    } else {
        throw new Error("unable to normalize when description");
    }
};
normalizeMove = function(x) {
    if (isState(x)) {
        return function(talos, event) {
            return talos.state = x;
        };
    } else if (Type.isFunction(x)) {
        return x;
    } else {
        throw new Error("unable to normalize move description");
    }
};
prioritize = function(frames) {
    return frames.sort(function(a, b) {
        if (a.priority < b.priority) {
            return -1;
        } else if (a.priority > b.priority) {
            return 1;
        } else {
            return 0;
        }
    });
};
Edge = {
    make: generic({
        name: "talos: make edge",
        default: function() {
            for(var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++){
                args[_key] = arguments[_key];
            }
            throw new Error(`talos make edge: input is malformed ${JSON.stringify(args)}`);
        }
    })
};
generic(Edge.make, Type.isObject, function(object) {
    return {
        when: normalizeWhen(object.when),
        run: object.run,
        move: normalizeMove(object.move)
    };
});
generic(Edge.make, isState, Type.isAny, function(move, _when) {
    return Edge.make({
        move,
        when: _when
    });
});
generic(Edge.make, isState, Type.isObject, function(move, object) {
    var ref, ref1;
    return {
        when: normalizeWhen((ref = object.when) != null ? ref : true),
        run: object.run,
        move: normalizeMove((ref1 = object.move) != null ? ref1 : move)
    };
});
Edges = {
    make: generic({
        name: "talos: make edges",
        default: function() {
            for(var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++){
                args[_key] = arguments[_key];
            }
            throw new Error(`talos make edges: input is malformed ${JSON.stringify(args)}`);
        }
    })
};
generic(Edges.make, Type.isObject, function(object) {
    var defaultFrame, edges, frames, j, k, key, len, len1, priority, ref, ref1, value;
    frames = [];
    defaultFrame = null;
    ref = Reflect.ownKeys(object);
    for(j = 0, len = ref.length; j < len; j++){
        key = ref[j];
        value = object[key];
        priority = (ref1 = value.priority) != null ? ref1 : 100;
        if (key === "default") {
            defaultFrame = {
                key,
                value
            };
        } else {
            if (key === "end") {
                key = $end;
            }
            frames.push({
                key,
                value,
                priority
            });
        }
    }
    prioritize(frames);
    edges = [];
    for(k = 0, len1 = frames.length; k < len1; k++){
        ({ key, value } = frames[k]);
        edges.push(Edge.make(key, value));
    }
    if (defaultFrame != null) {
        // default is a special case emphasizing an always true "when" function.
        ({ value } = defaultFrame);
        if (Type.isObject(value)) {
            edges.push(Edge.make({
                ...value,
                when: true
            }));
        } else {
            edges.push(Edge.make({
                when: true,
                move: value
            }));
        }
    }
    return edges;
});
generic(Edges.make, Type.isArray, function(array) {
    var edge, j, len, results;
    results = [];
    for(j = 0, len = array.length; j < len; j++){
        edge = array[j];
        results.push(Edge.make(edge));
    }
    return results;
});
generic(Edges.make, Type.isFunction, function(f) {
    var edge;
    edge = {
        when: true,
        run: f,
        move: $end
    };
    return [
        Edge.make(edge)
    ];
});
generic(Edges.make, isState, function(move) {
    return Edges.make({
        [move]: true
    });
});
generic(Edges.make, areVertexEdges, function(param) {
    let { edges } = param;
    var edge, j, len, results;
    results = [];
    for(j = 0, len = edges.length; j < len; j++){
        edge = edges[j];
        results.push({
            when: edge.when,
            run: edge.run,
            move: edge.move
        });
    }
    return results;
});
Vertex = {
    make: function(key, value) {
        return {
            name: key,
            edges: Edges.make(value)
        };
    }
};
Machine = {
    make: function(value) {
        var _graph, j, key, len, machine, ref;
        _graph = Machine.format(value);
        machine = {
            graph: {}
        };
        ref = Reflect.ownKeys(_graph);
        for(j = 0, len = ref.length; j < len; j++){
            key = ref[j];
            value = _graph[key];
            machine.graph[key] = Vertex.make(key, value);
        }
        return machine;
    },
    clone: function(_machine) {
        return Machine.make(_machine.graph);
    },
    format: function(value) {
        var graph, j, key, len, ref;
        if (Type.isObject(value)) {
            graph = {};
            ref = Reflect.ownKeys(value);
            for(j = 0, len = ref.length; j < len; j++){
                key = ref[j];
                graph[key] = value[key];
            }
        } else if (Type.isArray(value)) {
            graph = Machine.expand(value);
        } else {
            throw new Error("Talos machine representation is malformed");
        }
        if (graph[$start] == null) {
            if (graph.start != null) {
                graph[$start] = graph.start;
                delete graph.start;
            } else {
                throw new Error("no start state defined for this machine");
            }
        }
        if (graph[$end] == null) {
            if (graph.end != null) {
                graph[$end] = graph.end;
                delete graph.end;
            }
        }
        return graph;
    },
    expand: function(fx) {
        var current, f, graph, i, j, len, next;
        graph = {};
        for(i = j = 0, len = fx.length; j < len; i = ++j){
            f = fx[i];
            current = i === 0 ? $start : `${i}`;
            next = i === fx.length - 1 ? $end : `${i + 1}`;
            graph[current] = {
                next: {
                    when: true,
                    run: f,
                    move: next
                }
            };
        }
        return graph;
    }
};
export { Machine, Vertex, Edges, Edge }; //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3JjL21hY2hpbmUuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUEsSUFBQSxFQUFBLEtBQUEsRUFBQSxPQUFBLEVBQUEsTUFBQSxFQUFBLGNBQUEsRUFBQSxPQUFBLEVBQUEsYUFBQSxFQUFBLGFBQUEsRUFBQTs7QUFBQSxPQUFBO0VBQVMsT0FBVDtDQUFBLE1BQUE7O0FBQ0EsT0FBTyxDQUFBLFFBQVAsTUFBQTs7QUFDQSxPQUFBO0VBQVMsTUFBVDtFQUFpQixJQUFqQjtDQUFBLE1BQUE7O0FBRUEsT0FBQSxHQUFVLFFBQUEsQ0FBRSxDQUFGLENBQUE7U0FBUyxDQUFFLElBQUksQ0FBQyxRQUFMLENBQWMsQ0FBZCxDQUFGLENBQUEsSUFBdUIsQ0FBRSxJQUFJLENBQUMsUUFBTCxDQUFjLENBQWQsQ0FBRjtBQUFoQzs7QUFDVixjQUFBLEdBQWlCLFFBQUEsQ0FBRSxDQUFGLENBQUE7QUFDakIsTUFBQSxJQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQTtFQUFFLElBQWlCLGVBQWpCO0FBQUEsV0FBTyxNQUFQOztFQUNBLElBQWdCLENBQUMsSUFBSSxDQUFDLE9BQUwsQ0FBYSxDQUFDLENBQUMsS0FBZixDQUFqQjtBQUFBLFdBQU8sTUFBUDs7QUFDQTtFQUFBLEtBQUEscUNBQUE7O1FBQXlCLENBQUMsSUFBSSxDQUFDLFFBQUwsQ0FBYyxJQUFkO0FBQ3hCLGFBQU87O0VBRFQ7U0FFQTtBQUxlOztBQVFqQixhQUFBLEdBQWdCLFFBQUEsQ0FBRSxDQUFGLENBQUE7RUFDZCxJQUFHLE9BQUEsQ0FBUSxDQUFSLENBQUg7V0FDRSxRQUFBLENBQUUsS0FBRixFQUFTLEtBQVQsQ0FBQTthQUFvQixLQUFBLEtBQVM7SUFBN0IsRUFERjtHQUFBLE1BRUssSUFBRyxJQUFJLENBQUMsVUFBTCxDQUFnQixDQUFoQixDQUFIO1dBQ0gsRUFERztHQUFBLE1BRUEsSUFBRyxJQUFJLENBQUMsU0FBTCxDQUFlLENBQWYsQ0FBSDtXQUNILFFBQUEsQ0FBQSxDQUFBO2FBQUc7SUFBSCxFQURHO0dBQUEsTUFBQTtJQUdILE1BQU0sSUFBSSxLQUFKLENBQVUsc0NBQVYsRUFISDs7QUFMUzs7QUFVaEIsYUFBQSxHQUFnQixRQUFBLENBQUUsQ0FBRixDQUFBO0VBQ2QsSUFBRyxPQUFBLENBQVEsQ0FBUixDQUFIO1dBQ0UsUUFBQSxDQUFFLEtBQUYsRUFBUyxLQUFULENBQUE7YUFBb0IsS0FBSyxDQUFDLEtBQU4sR0FBYztJQUFsQyxFQURGO0dBQUEsTUFFSyxJQUFHLElBQUksQ0FBQyxVQUFMLENBQWdCLENBQWhCLENBQUg7V0FDSCxFQURHO0dBQUEsTUFBQTtJQUdILE1BQU0sSUFBSSxLQUFKLENBQVUsc0NBQVYsRUFISDs7QUFIUzs7QUFRaEIsVUFBQSxHQUFhLFFBQUEsQ0FBRSxNQUFGLENBQUE7U0FDWCxNQUFNLENBQUMsSUFBUCxDQUFZLFFBQUEsQ0FBRSxDQUFGLEVBQUssQ0FBTCxDQUFBO0lBQ1YsSUFBRyxDQUFDLENBQUMsUUFBRixHQUFhLENBQUMsQ0FBQyxRQUFsQjthQUNFLENBQUMsRUFESDtLQUFBLE1BRUssSUFBRyxDQUFDLENBQUMsUUFBRixHQUFhLENBQUMsQ0FBQyxRQUFsQjthQUNILEVBREc7S0FBQSxNQUFBO2FBR0gsRUFIRzs7RUFISyxDQUFaO0FBRFc7O0FBVWIsSUFBQSxHQUNFO0VBQUEsSUFBQSxFQUFNLE9BQUEsQ0FDSjtJQUFBLElBQUEsRUFBTSxrQkFBTjtJQUNBLE9BQUEsRUFBUyxRQUFBLENBQUEsR0FBRSxJQUFGLENBQUE7TUFDUCxNQUFNLElBQUksS0FBSixDQUFVLENBQUEsb0NBQUEsQ0FBQSxDQUF3QyxJQUFJLENBQUMsU0FBTCxDQUFlLElBQWYsQ0FBeEMsQ0FBQSxDQUFWO0lBREM7RUFEVCxDQURJO0FBQU47O0FBS0YsT0FBQSxDQUFRLElBQUksQ0FBQyxJQUFiLEVBQW1CLElBQUksQ0FBQyxRQUF4QixFQUFrQyxRQUFBLENBQUUsTUFBRixDQUFBO1NBQ2hDO0lBQUEsSUFBQSxFQUFNLGFBQUEsQ0FBYyxNQUFNLENBQUMsSUFBckIsQ0FBTjtJQUNBLEdBQUEsRUFBSyxNQUFNLENBQUMsR0FEWjtJQUVBLElBQUEsRUFBTSxhQUFBLENBQWMsTUFBTSxDQUFDLElBQXJCO0VBRk47QUFEZ0MsQ0FBbEM7O0FBS0EsT0FBQSxDQUFRLElBQUksQ0FBQyxJQUFiLEVBQW1CLE9BQW5CLEVBQTRCLElBQUksQ0FBQyxLQUFqQyxFQUF3QyxRQUFBLENBQUUsSUFBRixFQUFRLEtBQVIsQ0FBQTtTQUN0QyxJQUFJLENBQUMsSUFBTCxDQUFVO0lBQUUsSUFBRjtJQUFRLElBQUEsRUFBTTtFQUFkLENBQVY7QUFEc0MsQ0FBeEM7O0FBR0EsT0FBQSxDQUFRLElBQUksQ0FBQyxJQUFiLEVBQW1CLE9BQW5CLEVBQTRCLElBQUksQ0FBQyxRQUFqQyxFQUEyQyxRQUFBLENBQUUsSUFBRixFQUFRLE1BQVIsQ0FBQTtBQUMzQyxNQUFBLEdBQUEsRUFBQTtTQUFFO0lBQUEsSUFBQSxFQUFNLGFBQUEscUNBQTRCLElBQTVCLENBQU47SUFDQSxHQUFBLEVBQUssTUFBTSxDQUFDLEdBRFo7SUFFQSxJQUFBLEVBQU0sYUFBQSx1Q0FBNEIsSUFBNUI7RUFGTjtBQUR5QyxDQUEzQzs7QUFNQSxLQUFBLEdBQ0U7RUFBQSxJQUFBLEVBQU0sT0FBQSxDQUNKO0lBQUEsSUFBQSxFQUFNLG1CQUFOO0lBQ0EsT0FBQSxFQUFTLFFBQUEsQ0FBQSxHQUFFLElBQUYsQ0FBQTtNQUNQLE1BQU0sSUFBSSxLQUFKLENBQVUsQ0FBQSxxQ0FBQSxDQUFBLENBQXlDLElBQUksQ0FBQyxTQUFMLENBQWUsSUFBZixDQUF6QyxDQUFBLENBQVY7SUFEQztFQURULENBREk7QUFBTjs7QUFLRixPQUFBLENBQVEsS0FBSyxDQUFDLElBQWQsRUFBb0IsSUFBSSxDQUFDLFFBQXpCLEVBQW1DLFFBQUEsQ0FBRSxNQUFGLENBQUE7QUFDbkMsTUFBQSxZQUFBLEVBQUEsS0FBQSxFQUFBLE1BQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxFQUFBLFFBQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxFQUFBO0VBQUUsTUFBQSxHQUFTO0VBQ1QsWUFBQSxHQUFlO0FBQ2Y7RUFBQSxLQUFBLHFDQUFBOztJQUNFLEtBQUEsR0FBUSxNQUFNLENBQUUsR0FBRjtJQUNkLFFBQUEsNENBQTRCO0lBQzVCLElBQUcsR0FBQSxLQUFPLFNBQVY7TUFDRSxZQUFBLEdBQWUsQ0FBRSxHQUFGLEVBQU8sS0FBUCxFQURqQjtLQUFBLE1BQUE7TUFHRSxJQUFjLEdBQUEsS0FBTyxLQUFyQjtRQUFBLEdBQUEsR0FBTSxLQUFOOztNQUNBLE1BQU0sQ0FBQyxJQUFQLENBQVksQ0FBRSxHQUFGLEVBQU8sS0FBUCxFQUFjLFFBQWQsQ0FBWixFQUpGOztFQUhGO0VBU0EsVUFBQSxDQUFXLE1BQVg7RUFFQSxLQUFBLEdBQVE7RUFDUixLQUFBLDBDQUFBO0tBQUksQ0FBRSxHQUFGLEVBQU8sS0FBUDtJQUNGLEtBQUssQ0FBQyxJQUFOLENBQVcsSUFBSSxDQUFDLElBQUwsQ0FBVSxHQUFWLEVBQWUsS0FBZixDQUFYO0VBREY7RUFHQSxJQUFHLG9CQUFIOztJQUVFLENBQUEsQ0FBRSxLQUFGLENBQUEsR0FBWSxZQUFaO0lBQ0EsSUFBRyxJQUFJLENBQUMsUUFBTCxDQUFjLEtBQWQsQ0FBSDtNQUNFLEtBQUssQ0FBQyxJQUFOLENBQVcsSUFBSSxDQUFDLElBQUwsQ0FBVTtRQUFFLEdBQUEsS0FBRjtRQUFZLElBQUEsRUFBTTtNQUFsQixDQUFWLENBQVgsRUFERjtLQUFBLE1BQUE7TUFHRSxLQUFLLENBQUMsSUFBTixDQUFXLElBQUksQ0FBQyxJQUFMLENBQVU7UUFBQSxJQUFBLEVBQU0sSUFBTjtRQUFZLElBQUEsRUFBTTtNQUFsQixDQUFWLENBQVgsRUFIRjtLQUhGOztTQVFBO0FBMUJpQyxDQUFuQzs7QUE2QkEsT0FBQSxDQUFRLEtBQUssQ0FBQyxJQUFkLEVBQW9CLElBQUksQ0FBQyxPQUF6QixFQUFrQyxRQUFBLENBQUUsS0FBRixDQUFBO0FBQ2xDLE1BQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUE7QUFBRTtFQUFBLEtBQUEsdUNBQUE7O2lCQUNFLElBQUksQ0FBQyxJQUFMLENBQVUsSUFBVjtFQURGLENBQUE7O0FBRGdDLENBQWxDOztBQUlBLE9BQUEsQ0FBUSxLQUFLLENBQUMsSUFBZCxFQUFvQixJQUFJLENBQUMsVUFBekIsRUFBcUMsUUFBQSxDQUFFLENBQUYsQ0FBQTtBQUNyQyxNQUFBO0VBQUUsSUFBQSxHQUFPO0lBQUEsSUFBQSxFQUFNLElBQU47SUFBWSxHQUFBLEVBQUssQ0FBakI7SUFBb0IsSUFBQSxFQUFNO0VBQTFCO1NBQ1AsQ0FBRSxJQUFJLENBQUMsSUFBTCxDQUFVLElBQVYsQ0FBRjtBQUZtQyxDQUFyQzs7QUFJQSxPQUFBLENBQVEsS0FBSyxDQUFDLElBQWQsRUFBb0IsT0FBcEIsRUFBNkIsUUFBQSxDQUFFLElBQUYsQ0FBQTtTQUMzQixLQUFLLENBQUMsSUFBTixDQUFXO0lBQUEsQ0FBRSxJQUFGLENBQUEsRUFBVTtFQUFWLENBQVg7QUFEMkIsQ0FBN0I7O0FBR0EsT0FBQSxDQUFRLEtBQUssQ0FBQyxJQUFkLEVBQW9CLGNBQXBCLEVBQW9DLFFBQUEsQ0FBQyxDQUFFLEtBQUYsQ0FBRCxDQUFBO0FBQ3BDLE1BQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxHQUFBLEVBQUE7QUFBRTtFQUFBLEtBQUEsdUNBQUE7O2lCQUNFO01BQUEsSUFBQSxFQUFNLElBQUksQ0FBQyxJQUFYO01BQ0EsR0FBQSxFQUFLLElBQUksQ0FBQyxHQURWO01BRUEsSUFBQSxFQUFNLElBQUksQ0FBQztJQUZYO0VBREYsQ0FBQTs7QUFEa0MsQ0FBcEM7O0FBT0EsTUFBQSxHQUNFO0VBQUEsSUFBQSxFQUFNLFFBQUEsQ0FBRSxHQUFGLEVBQU8sS0FBUCxDQUFBO1dBQ0o7TUFBQSxJQUFBLEVBQU0sR0FBTjtNQUNBLEtBQUEsRUFBTyxLQUFLLENBQUMsSUFBTixDQUFXLEtBQVg7SUFEUDtFQURJO0FBQU47O0FBS0YsT0FBQSxHQUNFO0VBQUEsSUFBQSxFQUFNLFFBQUEsQ0FBRSxLQUFGLENBQUE7QUFDUixRQUFBLE1BQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBLEdBQUEsRUFBQSxPQUFBLEVBQUE7SUFBSSxNQUFBLEdBQVMsT0FBTyxDQUFDLE1BQVIsQ0FBZSxLQUFmO0lBQ1QsT0FBQSxHQUFVO01BQUEsS0FBQSxFQUFPLENBQUE7SUFBUDtBQUVWO0lBQUEsS0FBQSxxQ0FBQTs7TUFDRSxLQUFBLEdBQVEsTUFBTSxDQUFFLEdBQUY7TUFDZCxPQUFPLENBQUMsS0FBSyxDQUFFLEdBQUYsQ0FBYixHQUF1QixNQUFNLENBQUMsSUFBUCxDQUFZLEdBQVosRUFBaUIsS0FBakI7SUFGekI7V0FJQTtFQVJJLENBQU47RUFXQSxLQUFBLEVBQU8sUUFBQSxDQUFFLFFBQUYsQ0FBQTtXQUNMLE9BQU8sQ0FBQyxJQUFSLENBQWEsUUFBUSxDQUFDLEtBQXRCO0VBREssQ0FYUDtFQWNBLE1BQUEsRUFBUSxRQUFBLENBQUUsS0FBRixDQUFBO0FBQ1YsUUFBQSxLQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUE7SUFBSSxJQUFHLElBQUksQ0FBQyxRQUFMLENBQWMsS0FBZCxDQUFIO01BQ0UsS0FBQSxHQUFRLENBQUE7QUFDUjtNQUFBLEtBQUEscUNBQUE7O1FBQ0UsS0FBSyxDQUFFLEdBQUYsQ0FBTCxHQUFlLEtBQUssQ0FBRSxHQUFGO01BRHRCLENBRkY7S0FBQSxNQUlLLElBQUcsSUFBSSxDQUFDLE9BQUwsQ0FBYSxLQUFiLENBQUg7TUFDSCxLQUFBLEdBQVEsT0FBTyxDQUFDLE1BQVIsQ0FBZSxLQUFmLEVBREw7S0FBQSxNQUFBO01BR0gsTUFBTSxJQUFJLEtBQUosQ0FBVSwyQ0FBVixFQUhIOztJQUtMLElBQUkscUJBQUo7TUFDRSxJQUFHLG1CQUFIO1FBQ0UsS0FBSyxDQUFFLE1BQUYsQ0FBTCxHQUFrQixLQUFLLENBQUM7UUFDeEIsT0FBTyxLQUFLLENBQUMsTUFGZjtPQUFBLE1BQUE7UUFJRSxNQUFNLElBQUksS0FBSixDQUFVLHlDQUFWLEVBSlI7T0FERjs7SUFPQSxJQUFJLG1CQUFKO01BQ0UsSUFBRyxpQkFBSDtRQUNFLEtBQUssQ0FBRSxJQUFGLENBQUwsR0FBZ0IsS0FBSyxDQUFDO1FBQ3RCLE9BQU8sS0FBSyxDQUFDLElBRmY7T0FERjs7V0FLQTtFQXRCTSxDQWRSO0VBc0NBLE1BQUEsRUFBUSxRQUFBLENBQUUsRUFBRixDQUFBO0FBQ1YsUUFBQSxPQUFBLEVBQUEsQ0FBQSxFQUFBLEtBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQTtJQUFJLEtBQUEsR0FBUSxDQUFBO0lBQ1IsS0FBQSw0Q0FBQTs7TUFDRSxPQUFBLEdBQWEsQ0FBQSxLQUFLLENBQVIsR0FBZSxNQUFmLEdBQTJCLENBQUEsQ0FBQSxDQUFJLENBQUosQ0FBQTtNQUNyQyxJQUFBLEdBQVUsQ0FBQSxLQUFLLEVBQUUsQ0FBQyxNQUFILEdBQVksQ0FBcEIsR0FBMkIsSUFBM0IsR0FBcUMsQ0FBQSxDQUFBLENBQUksQ0FBQSxHQUFJLENBQVIsQ0FBQTtNQUU1QyxLQUFLLENBQUUsT0FBRixDQUFMLEdBQ0U7UUFBQSxJQUFBLEVBQ0U7VUFBQSxJQUFBLEVBQU0sSUFBTjtVQUNBLEdBQUEsRUFBSyxDQURMO1VBRUEsSUFBQSxFQUFNO1FBRk47TUFERjtJQUxKO1dBVUE7RUFaTTtBQXRDUjs7QUFxREYsT0FBQTtFQUFTLE9BQVQ7RUFBa0IsTUFBbEI7RUFBMEIsS0FBMUI7RUFBaUMsSUFBakMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZW5lcmljIH0gZnJvbSBcIkBkYXNoa2l0ZS9qb3kvZ2VuZXJpY1wiXG5pbXBvcnQgKiBhcyBUeXBlIGZyb20gXCJAZGFzaGtpdGUvam95L3R5cGVcIlxuaW1wb3J0IHsgJHN0YXJ0LCAkZW5kIH0gZnJvbSBcIi4vc3RhdGVzXCJcblxuaXNTdGF0ZSA9ICggeCApIC0+ICggVHlwZS5pc1N0cmluZyB4ICkgfHwgKCBUeXBlLmlzU3ltYm9sIHggKVxuYXJlVmVydGV4RWRnZXMgPSAoIHggKSAtPlxuICByZXR1cm4gZmFsc2UgaWYgIXguZWRnZXM/XG4gIHJldHVybiBmYWxzZSBpZiAhVHlwZS5pc0FycmF5IHguZWRnZXNcbiAgZm9yIGVkZ2UgaW4geC5lZGdlcyB3aGVuICFUeXBlLmlzT2JqZWN0IGVkZ2VcbiAgICByZXR1cm4gZmFsc2VcbiAgdHJ1ZVxuXG5cbm5vcm1hbGl6ZVdoZW4gPSAoIHggKSAtPlxuICBpZiBpc1N0YXRlIHhcbiAgICAoIHRhbG9zLCBldmVudCApIC0+IGV2ZW50ID09IGNvbmRpdGlvblxuICBlbHNlIGlmIFR5cGUuaXNGdW5jdGlvbiB4XG4gICAgeFxuICBlbHNlIGlmIFR5cGUuaXNCb29sZWFuIHhcbiAgICAtPiB4XG4gIGVsc2VcbiAgICB0aHJvdyBuZXcgRXJyb3IgXCJ1bmFibGUgdG8gbm9ybWFsaXplIHdoZW4gZGVzY3JpcHRpb25cIlxuXG5ub3JtYWxpemVNb3ZlID0gKCB4ICkgLT5cbiAgaWYgaXNTdGF0ZSB4XG4gICAgKCB0YWxvcywgZXZlbnQgKSAtPiB0YWxvcy5zdGF0ZSA9IHhcbiAgZWxzZSBpZiBUeXBlLmlzRnVuY3Rpb24geFxuICAgIHhcbiAgZWxzZVxuICAgIHRocm93IG5ldyBFcnJvciBcInVuYWJsZSB0byBub3JtYWxpemUgbW92ZSBkZXNjcmlwdGlvblwiXG5cbnByaW9yaXRpemUgPSAoIGZyYW1lcyApIC0+XG4gIGZyYW1lcy5zb3J0ICggYSwgYiApIC0+IFxuICAgIGlmIGEucHJpb3JpdHkgPCBiLnByaW9yaXR5XG4gICAgICAtMVxuICAgIGVsc2UgaWYgYS5wcmlvcml0eSA+IGIucHJpb3JpdHlcbiAgICAgIDFcbiAgICBlbHNlXG4gICAgICAwXG5cblxuRWRnZSA9XG4gIG1ha2U6IGdlbmVyaWMgXG4gICAgbmFtZTogXCJ0YWxvczogbWFrZSBlZGdlXCJcbiAgICBkZWZhdWx0OiAoIGFyZ3MuLi4gKSAtPiBcbiAgICAgIHRocm93IG5ldyBFcnJvciBcInRhbG9zIG1ha2UgZWRnZTogaW5wdXQgaXMgbWFsZm9ybWVkICN7IEpTT04uc3RyaW5naWZ5IGFyZ3MgfVwiXG5cbmdlbmVyaWMgRWRnZS5tYWtlLCBUeXBlLmlzT2JqZWN0LCAoIG9iamVjdCApIC0+XG4gIHdoZW46IG5vcm1hbGl6ZVdoZW4gb2JqZWN0LndoZW5cbiAgcnVuOiBvYmplY3QucnVuXG4gIG1vdmU6IG5vcm1hbGl6ZU1vdmUgb2JqZWN0Lm1vdmVcblxuZ2VuZXJpYyBFZGdlLm1ha2UsIGlzU3RhdGUsIFR5cGUuaXNBbnksICggbW92ZSwgX3doZW4gKSAtPlxuICBFZGdlLm1ha2UgeyBtb3ZlLCB3aGVuOiBfd2hlbiB9XG5cbmdlbmVyaWMgRWRnZS5tYWtlLCBpc1N0YXRlLCBUeXBlLmlzT2JqZWN0LCAoIG1vdmUsIG9iamVjdCApIC0+XG4gIHdoZW46IG5vcm1hbGl6ZVdoZW4gb2JqZWN0LndoZW4gPyB0cnVlXG4gIHJ1bjogb2JqZWN0LnJ1blxuICBtb3ZlOiBub3JtYWxpemVNb3ZlIG9iamVjdC5tb3ZlID8gbW92ZVxuXG5cbkVkZ2VzID0gXG4gIG1ha2U6IGdlbmVyaWMgXG4gICAgbmFtZTogXCJ0YWxvczogbWFrZSBlZGdlc1wiXG4gICAgZGVmYXVsdDogKCBhcmdzLi4uICkgLT4gXG4gICAgICB0aHJvdyBuZXcgRXJyb3IgXCJ0YWxvcyBtYWtlIGVkZ2VzOiBpbnB1dCBpcyBtYWxmb3JtZWQgI3sgSlNPTi5zdHJpbmdpZnkgYXJncyB9XCJcblxuZ2VuZXJpYyBFZGdlcy5tYWtlLCBUeXBlLmlzT2JqZWN0LCAoIG9iamVjdCApIC0+XG4gIGZyYW1lcyA9IFtdXG4gIGRlZmF1bHRGcmFtZSA9IG51bGxcbiAgZm9yIGtleSBpbiBSZWZsZWN0Lm93bktleXMgb2JqZWN0XG4gICAgdmFsdWUgPSBvYmplY3RbIGtleSBdXG4gICAgcHJpb3JpdHkgPSB2YWx1ZS5wcmlvcml0eSA/IDEwMFxuICAgIGlmIGtleSA9PSBcImRlZmF1bHRcIlxuICAgICAgZGVmYXVsdEZyYW1lID0geyBrZXksIHZhbHVlIH1cbiAgICBlbHNlXG4gICAgICBrZXkgPSAkZW5kIGlmIGtleSA9PSBcImVuZFwiXG4gICAgICBmcmFtZXMucHVzaCB7IGtleSwgdmFsdWUsIHByaW9yaXR5IH1cblxuICBwcmlvcml0aXplIGZyYW1lc1xuXG4gIGVkZ2VzID0gW11cbiAgZm9yIHsga2V5LCB2YWx1ZSB9IGluIGZyYW1lc1xuICAgIGVkZ2VzLnB1c2ggRWRnZS5tYWtlIGtleSwgdmFsdWVcblxuICBpZiBkZWZhdWx0RnJhbWU/XG4gICAgIyBkZWZhdWx0IGlzIGEgc3BlY2lhbCBjYXNlIGVtcGhhc2l6aW5nIGFuIGFsd2F5cyB0cnVlIFwid2hlblwiIGZ1bmN0aW9uLlxuICAgIHsgdmFsdWUgfSA9IGRlZmF1bHRGcmFtZVxuICAgIGlmIFR5cGUuaXNPYmplY3QgdmFsdWVcbiAgICAgIGVkZ2VzLnB1c2ggRWRnZS5tYWtlIHsgdmFsdWUuLi4sIHdoZW46IHRydWUgfVxuICAgIGVsc2VcbiAgICAgIGVkZ2VzLnB1c2ggRWRnZS5tYWtlIHdoZW46IHRydWUsIG1vdmU6IHZhbHVlXG4gIFxuICBlZGdlc1xuICBcblxuZ2VuZXJpYyBFZGdlcy5tYWtlLCBUeXBlLmlzQXJyYXksICggYXJyYXkgKSAtPlxuICBmb3IgZWRnZSBpbiBhcnJheVxuICAgIEVkZ2UubWFrZSBlZGdlXG5cbmdlbmVyaWMgRWRnZXMubWFrZSwgVHlwZS5pc0Z1bmN0aW9uLCAoIGYgKSAtPlxuICBlZGdlID0gd2hlbjogdHJ1ZSwgcnVuOiBmLCBtb3ZlOiAkZW5kXG4gIFsgRWRnZS5tYWtlIGVkZ2UgXVxuXG5nZW5lcmljIEVkZ2VzLm1ha2UsIGlzU3RhdGUsICggbW92ZSApIC0+XG4gIEVkZ2VzLm1ha2UgWyBtb3ZlIF06IHRydWVcblxuZ2VuZXJpYyBFZGdlcy5tYWtlLCBhcmVWZXJ0ZXhFZGdlcywgKHsgZWRnZXMgfSkgLT5cbiAgZm9yIGVkZ2UgaW4gZWRnZXNcbiAgICB3aGVuOiBlZGdlLndoZW5cbiAgICBydW46IGVkZ2UucnVuXG4gICAgbW92ZTogZWRnZS5tb3ZlXG5cblxuVmVydGV4ID1cbiAgbWFrZTogKCBrZXksIHZhbHVlICkgLT5cbiAgICBuYW1lOiBrZXlcbiAgICBlZGdlczogRWRnZXMubWFrZSB2YWx1ZVxuXG5cbk1hY2hpbmUgPVxuICBtYWtlOiAoIHZhbHVlICkgLT4gXG4gICAgX2dyYXBoID0gTWFjaGluZS5mb3JtYXQgdmFsdWVcbiAgICBtYWNoaW5lID0gZ3JhcGg6IHt9XG5cbiAgICBmb3Iga2V5IGluIFJlZmxlY3Qub3duS2V5cyBfZ3JhcGhcbiAgICAgIHZhbHVlID0gX2dyYXBoWyBrZXkgXVxuICAgICAgbWFjaGluZS5ncmFwaFsga2V5IF0gPSBWZXJ0ZXgubWFrZSBrZXksIHZhbHVlXG4gICAgXG4gICAgbWFjaGluZVxuXG5cbiAgY2xvbmU6ICggX21hY2hpbmUgKSAtPlxuICAgIE1hY2hpbmUubWFrZSBfbWFjaGluZS5ncmFwaFxuXG4gIGZvcm1hdDogKCB2YWx1ZSApIC0+XG4gICAgaWYgVHlwZS5pc09iamVjdCB2YWx1ZVxuICAgICAgZ3JhcGggPSB7fVxuICAgICAgZm9yIGtleSBpbiBSZWZsZWN0Lm93bktleXMgdmFsdWVcbiAgICAgICAgZ3JhcGhbIGtleSBdID0gdmFsdWVbIGtleSBdXG4gICAgZWxzZSBpZiBUeXBlLmlzQXJyYXkgdmFsdWVcbiAgICAgIGdyYXBoID0gTWFjaGluZS5leHBhbmQgdmFsdWVcbiAgICBlbHNlXG4gICAgICB0aHJvdyBuZXcgRXJyb3IgXCJUYWxvcyBtYWNoaW5lIHJlcHJlc2VudGF0aW9uIGlzIG1hbGZvcm1lZFwiXG4gICAgXG4gICAgaWYgIWdyYXBoWyAkc3RhcnQgXT9cbiAgICAgIGlmIGdyYXBoLnN0YXJ0P1xuICAgICAgICBncmFwaFsgJHN0YXJ0IF0gPSBncmFwaC5zdGFydFxuICAgICAgICBkZWxldGUgZ3JhcGguc3RhcnRcbiAgICAgIGVsc2VcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yIFwibm8gc3RhcnQgc3RhdGUgZGVmaW5lZCBmb3IgdGhpcyBtYWNoaW5lXCJcblxuICAgIGlmICFncmFwaFsgJGVuZCBdP1xuICAgICAgaWYgZ3JhcGguZW5kP1xuICAgICAgICBncmFwaFsgJGVuZCBdID0gZ3JhcGguZW5kXG4gICAgICAgIGRlbGV0ZSBncmFwaC5lbmRcblxuICAgIGdyYXBoXG5cbiAgZXhwYW5kOiAoIGZ4ICkgLT5cbiAgICBncmFwaCA9IHt9ICAgIFxuICAgIGZvciBmLCBpIGluIGZ4XG4gICAgICBjdXJyZW50ID0gaWYgaSA9PSAwIHRoZW4gJHN0YXJ0IGVsc2UgXCIjeyBpIH1cIlxuICAgICAgbmV4dCA9IGlmIGkgPT0gZngubGVuZ3RoIC0gMSB0aGVuICRlbmQgZWxzZSBcIiN7IGkgKyAxIH1cIlxuXG4gICAgICBncmFwaFsgY3VycmVudCBdID0gXG4gICAgICAgIG5leHQ6XG4gICAgICAgICAgd2hlbjogdHJ1ZVxuICAgICAgICAgIHJ1bjogZlxuICAgICAgICAgIG1vdmU6IG5leHRcbiAgICBcbiAgICBncmFwaFxuXG5cbmV4cG9ydCB7IE1hY2hpbmUsIFZlcnRleCwgRWRnZXMsIEVkZ2UgfSJdfQ==
 //# sourceURL=src/machine.coffee

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9tYWNoaW5lLmNvZmZlZSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZW5lcmljIH0gZnJvbSBcIkBkYXNoa2l0ZS9qb3kvZ2VuZXJpY1wiXG5pbXBvcnQgKiBhcyBUeXBlIGZyb20gXCJAZGFzaGtpdGUvam95L3R5cGVcIlxuaW1wb3J0IHsgJHN0YXJ0LCAkZW5kIH0gZnJvbSBcIi4vc3RhdGVzXCJcblxuaXNTdGF0ZSA9ICggeCApIC0+ICggVHlwZS5pc1N0cmluZyB4ICkgfHwgKCBUeXBlLmlzU3ltYm9sIHggKVxuYXJlVmVydGV4RWRnZXMgPSAoIHggKSAtPlxuICByZXR1cm4gZmFsc2UgaWYgIXguZWRnZXM/XG4gIHJldHVybiBmYWxzZSBpZiAhVHlwZS5pc0FycmF5IHguZWRnZXNcbiAgZm9yIGVkZ2UgaW4geC5lZGdlcyB3aGVuICFUeXBlLmlzT2JqZWN0IGVkZ2VcbiAgICByZXR1cm4gZmFsc2VcbiAgdHJ1ZVxuXG5cbm5vcm1hbGl6ZVdoZW4gPSAoIHggKSAtPlxuICBpZiBpc1N0YXRlIHhcbiAgICAoIHRhbG9zLCBldmVudCApIC0+IGV2ZW50ID09IGNvbmRpdGlvblxuICBlbHNlIGlmIFR5cGUuaXNGdW5jdGlvbiB4XG4gICAgeFxuICBlbHNlIGlmIFR5cGUuaXNCb29sZWFuIHhcbiAgICAtPiB4XG4gIGVsc2VcbiAgICB0aHJvdyBuZXcgRXJyb3IgXCJ1bmFibGUgdG8gbm9ybWFsaXplIHdoZW4gZGVzY3JpcHRpb25cIlxuXG5ub3JtYWxpemVNb3ZlID0gKCB4ICkgLT5cbiAgaWYgaXNTdGF0ZSB4XG4gICAgKCB0YWxvcywgZXZlbnQgKSAtPiB0YWxvcy5zdGF0ZSA9IHhcbiAgZWxzZSBpZiBUeXBlLmlzRnVuY3Rpb24geFxuICAgIHhcbiAgZWxzZVxuICAgIHRocm93IG5ldyBFcnJvciBcInVuYWJsZSB0byBub3JtYWxpemUgbW92ZSBkZXNjcmlwdGlvblwiXG5cbnByaW9yaXRpemUgPSAoIGZyYW1lcyApIC0+XG4gIGZyYW1lcy5zb3J0ICggYSwgYiApIC0+IFxuICAgIGlmIGEucHJpb3JpdHkgPCBiLnByaW9yaXR5XG4gICAgICAtMVxuICAgIGVsc2UgaWYgYS5wcmlvcml0eSA+IGIucHJpb3JpdHlcbiAgICAgIDFcbiAgICBlbHNlXG4gICAgICAwXG5cblxuRWRnZSA9XG4gIG1ha2U6IGdlbmVyaWMgXG4gICAgbmFtZTogXCJ0YWxvczogbWFrZSBlZGdlXCJcbiAgICBkZWZhdWx0OiAoIGFyZ3MuLi4gKSAtPiBcbiAgICAgIHRocm93IG5ldyBFcnJvciBcInRhbG9zIG1ha2UgZWRnZTogaW5wdXQgaXMgbWFsZm9ybWVkICN7IEpTT04uc3RyaW5naWZ5IGFyZ3MgfVwiXG5cbmdlbmVyaWMgRWRnZS5tYWtlLCBUeXBlLmlzT2JqZWN0LCAoIG9iamVjdCApIC0+XG4gIHdoZW46IG5vcm1hbGl6ZVdoZW4gb2JqZWN0LndoZW5cbiAgcnVuOiBvYmplY3QucnVuXG4gIG1vdmU6IG5vcm1hbGl6ZU1vdmUgb2JqZWN0Lm1vdmVcblxuZ2VuZXJpYyBFZGdlLm1ha2UsIGlzU3RhdGUsIFR5cGUuaXNBbnksICggbW92ZSwgX3doZW4gKSAtPlxuICBFZGdlLm1ha2UgeyBtb3ZlLCB3aGVuOiBfd2hlbiB9XG5cbmdlbmVyaWMgRWRnZS5tYWtlLCBpc1N0YXRlLCBUeXBlLmlzT2JqZWN0LCAoIG1vdmUsIG9iamVjdCApIC0+XG4gIHdoZW46IG5vcm1hbGl6ZVdoZW4gb2JqZWN0LndoZW4gPyB0cnVlXG4gIHJ1bjogb2JqZWN0LnJ1blxuICBtb3ZlOiBub3JtYWxpemVNb3ZlIG9iamVjdC5tb3ZlID8gbW92ZVxuXG5cbkVkZ2VzID0gXG4gIG1ha2U6IGdlbmVyaWMgXG4gICAgbmFtZTogXCJ0YWxvczogbWFrZSBlZGdlc1wiXG4gICAgZGVmYXVsdDogKCBhcmdzLi4uICkgLT4gXG4gICAgICB0aHJvdyBuZXcgRXJyb3IgXCJ0YWxvcyBtYWtlIGVkZ2VzOiBpbnB1dCBpcyBtYWxmb3JtZWQgI3sgSlNPTi5zdHJpbmdpZnkgYXJncyB9XCJcblxuZ2VuZXJpYyBFZGdlcy5tYWtlLCBUeXBlLmlzT2JqZWN0LCAoIG9iamVjdCApIC0+XG4gIGZyYW1lcyA9IFtdXG4gIGRlZmF1bHRGcmFtZSA9IG51bGxcbiAgZm9yIGtleSBpbiBSZWZsZWN0Lm93bktleXMgb2JqZWN0XG4gICAgdmFsdWUgPSBvYmplY3RbIGtleSBdXG4gICAgcHJpb3JpdHkgPSB2YWx1ZS5wcmlvcml0eSA/IDEwMFxuICAgIGlmIGtleSA9PSBcImRlZmF1bHRcIlxuICAgICAgZGVmYXVsdEZyYW1lID0geyBrZXksIHZhbHVlIH1cbiAgICBlbHNlXG4gICAgICBrZXkgPSAkZW5kIGlmIGtleSA9PSBcImVuZFwiXG4gICAgICBmcmFtZXMucHVzaCB7IGtleSwgdmFsdWUsIHByaW9yaXR5IH1cblxuICBwcmlvcml0aXplIGZyYW1lc1xuXG4gIGVkZ2VzID0gW11cbiAgZm9yIHsga2V5LCB2YWx1ZSB9IGluIGZyYW1lc1xuICAgIGVkZ2VzLnB1c2ggRWRnZS5tYWtlIGtleSwgdmFsdWVcblxuICBpZiBkZWZhdWx0RnJhbWU/XG4gICAgIyBkZWZhdWx0IGlzIGEgc3BlY2lhbCBjYXNlIGVtcGhhc2l6aW5nIGFuIGFsd2F5cyB0cnVlIFwid2hlblwiIGZ1bmN0aW9uLlxuICAgIHsgdmFsdWUgfSA9IGRlZmF1bHRGcmFtZVxuICAgIGlmIFR5cGUuaXNPYmplY3QgdmFsdWVcbiAgICAgIGVkZ2VzLnB1c2ggRWRnZS5tYWtlIHsgdmFsdWUuLi4sIHdoZW46IHRydWUgfVxuICAgIGVsc2VcbiAgICAgIGVkZ2VzLnB1c2ggRWRnZS5tYWtlIHdoZW46IHRydWUsIG1vdmU6IHZhbHVlXG4gIFxuICBlZGdlc1xuICBcblxuZ2VuZXJpYyBFZGdlcy5tYWtlLCBUeXBlLmlzQXJyYXksICggYXJyYXkgKSAtPlxuICBmb3IgZWRnZSBpbiBhcnJheVxuICAgIEVkZ2UubWFrZSBlZGdlXG5cbmdlbmVyaWMgRWRnZXMubWFrZSwgVHlwZS5pc0Z1bmN0aW9uLCAoIGYgKSAtPlxuICBlZGdlID0gd2hlbjogdHJ1ZSwgcnVuOiBmLCBtb3ZlOiAkZW5kXG4gIFsgRWRnZS5tYWtlIGVkZ2UgXVxuXG5nZW5lcmljIEVkZ2VzLm1ha2UsIGlzU3RhdGUsICggbW92ZSApIC0+XG4gIEVkZ2VzLm1ha2UgWyBtb3ZlIF06IHRydWVcblxuZ2VuZXJpYyBFZGdlcy5tYWtlLCBhcmVWZXJ0ZXhFZGdlcywgKHsgZWRnZXMgfSkgLT5cbiAgZm9yIGVkZ2UgaW4gZWRnZXNcbiAgICB3aGVuOiBlZGdlLndoZW5cbiAgICBydW46IGVkZ2UucnVuXG4gICAgbW92ZTogZWRnZS5tb3ZlXG5cblxuVmVydGV4ID1cbiAgbWFrZTogKCBrZXksIHZhbHVlICkgLT5cbiAgICBuYW1lOiBrZXlcbiAgICBlZGdlczogRWRnZXMubWFrZSB2YWx1ZVxuXG5cbk1hY2hpbmUgPVxuICBtYWtlOiAoIHZhbHVlICkgLT4gXG4gICAgX2dyYXBoID0gTWFjaGluZS5mb3JtYXQgdmFsdWVcbiAgICBtYWNoaW5lID0gZ3JhcGg6IHt9XG5cbiAgICBmb3Iga2V5IGluIFJlZmxlY3Qub3duS2V5cyBfZ3JhcGhcbiAgICAgIHZhbHVlID0gX2dyYXBoWyBrZXkgXVxuICAgICAgbWFjaGluZS5ncmFwaFsga2V5IF0gPSBWZXJ0ZXgubWFrZSBrZXksIHZhbHVlXG4gICAgXG4gICAgbWFjaGluZVxuXG5cbiAgY2xvbmU6ICggX21hY2hpbmUgKSAtPlxuICAgIE1hY2hpbmUubWFrZSBfbWFjaGluZS5ncmFwaFxuXG4gIGZvcm1hdDogKCB2YWx1ZSApIC0+XG4gICAgaWYgVHlwZS5pc09iamVjdCB2YWx1ZVxuICAgICAgZ3JhcGggPSB7fVxuICAgICAgZm9yIGtleSBpbiBSZWZsZWN0Lm93bktleXMgdmFsdWVcbiAgICAgICAgZ3JhcGhbIGtleSBdID0gdmFsdWVbIGtleSBdXG4gICAgZWxzZSBpZiBUeXBlLmlzQXJyYXkgdmFsdWVcbiAgICAgIGdyYXBoID0gTWFjaGluZS5leHBhbmQgdmFsdWVcbiAgICBlbHNlXG4gICAgICB0aHJvdyBuZXcgRXJyb3IgXCJUYWxvcyBtYWNoaW5lIHJlcHJlc2VudGF0aW9uIGlzIG1hbGZvcm1lZFwiXG4gICAgXG4gICAgaWYgIWdyYXBoWyAkc3RhcnQgXT9cbiAgICAgIGlmIGdyYXBoLnN0YXJ0P1xuICAgICAgICBncmFwaFsgJHN0YXJ0IF0gPSBncmFwaC5zdGFydFxuICAgICAgICBkZWxldGUgZ3JhcGguc3RhcnRcbiAgICAgIGVsc2VcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yIFwibm8gc3RhcnQgc3RhdGUgZGVmaW5lZCBmb3IgdGhpcyBtYWNoaW5lXCJcblxuICAgIGlmICFncmFwaFsgJGVuZCBdP1xuICAgICAgaWYgZ3JhcGguZW5kP1xuICAgICAgICBncmFwaFsgJGVuZCBdID0gZ3JhcGguZW5kXG4gICAgICAgIGRlbGV0ZSBncmFwaC5lbmRcblxuICAgIGdyYXBoXG5cbiAgZXhwYW5kOiAoIGZ4ICkgLT5cbiAgICBncmFwaCA9IHt9ICAgIFxuICAgIGZvciBmLCBpIGluIGZ4XG4gICAgICBjdXJyZW50ID0gaWYgaSA9PSAwIHRoZW4gJHN0YXJ0IGVsc2UgXCIjeyBpIH1cIlxuICAgICAgbmV4dCA9IGlmIGkgPT0gZngubGVuZ3RoIC0gMSB0aGVuICRlbmQgZWxzZSBcIiN7IGkgKyAxIH1cIlxuXG4gICAgICBncmFwaFsgY3VycmVudCBdID0gXG4gICAgICAgIG5leHQ6XG4gICAgICAgICAgd2hlbjogdHJ1ZVxuICAgICAgICAgIHJ1bjogZlxuICAgICAgICAgIG1vdmU6IG5leHRcbiAgICBcbiAgICBncmFwaFxuXG5cbmV4cG9ydCB7IE1hY2hpbmUsIFZlcnRleCwgRWRnZXMsIEVkZ2UgfSJdLCJuYW1lcyI6WyJFZGdlIiwiRWRnZXMiLCJNYWNoaW5lIiwiVmVydGV4IiwiYXJlVmVydGV4RWRnZXMiLCJpc1N0YXRlIiwibm9ybWFsaXplTW92ZSIsIm5vcm1hbGl6ZVdoZW4iLCJwcmlvcml0aXplIiwiZ2VuZXJpYyIsIlR5cGUiLCIkc3RhcnQiLCIkZW5kIiwieCIsImlzU3RyaW5nIiwiaXNTeW1ib2wiLCJlZGdlIiwiaiIsImxlbiIsInJlZiIsImVkZ2VzIiwiaXNBcnJheSIsImxlbmd0aCIsImlzT2JqZWN0IiwidGFsb3MiLCJldmVudCIsImNvbmRpdGlvbiIsImlzRnVuY3Rpb24iLCJpc0Jvb2xlYW4iLCJFcnJvciIsInN0YXRlIiwiZnJhbWVzIiwic29ydCIsImEiLCJiIiwicHJpb3JpdHkiLCJtYWtlIiwibmFtZSIsImRlZmF1bHQiLCJhcmdzIiwiSlNPTiIsInN0cmluZ2lmeSIsIm9iamVjdCIsIndoZW4iLCJydW4iLCJtb3ZlIiwiaXNBbnkiLCJfd2hlbiIsInJlZjEiLCJkZWZhdWx0RnJhbWUiLCJrIiwia2V5IiwibGVuMSIsInZhbHVlIiwiUmVmbGVjdCIsIm93bktleXMiLCJwdXNoIiwiYXJyYXkiLCJyZXN1bHRzIiwiZiIsIl9ncmFwaCIsIm1hY2hpbmUiLCJmb3JtYXQiLCJncmFwaCIsImNsb25lIiwiX21hY2hpbmUiLCJleHBhbmQiLCJzdGFydCIsImVuZCIsImZ4IiwiY3VycmVudCIsImkiLCJuZXh0Il0sIm1hcHBpbmdzIjoiQUFBQSxJQUFBQSxNQUFBQyxPQUFBQyxTQUFBQyxRQUFBQyxnQkFBQUMsU0FBQUMsZUFBQUMsZUFBQUM7QUFBQSxTQUFTQyxPQUFULFFBQUEsd0JBQUE7QUFDQSxZQUFPQyxVQUFQLHFCQUFBO0FBQ0EsU0FBU0MsTUFBVCxFQUFpQkMsSUFBakIsUUFBQSxXQUFBO0FBRUFQLFVBQVUsU0FBRVEsQ0FBRjtXQUFTLEFBQUVILEtBQUtJLFFBQUwsQ0FBY0QsTUFBU0gsS0FBS0ssUUFBTCxDQUFjRjtBQUFoRDtBQUNWVCxpQkFBaUIsU0FBRVMsQ0FBRjtJQUNqQixJQUFBRyxNQUFBQyxHQUFBQyxLQUFBQztJQUFFLElBQWlCTixFQUFBTyxLQUFBLElBQUEsTUFBakI7UUFBQSxPQUFPOztJQUNQLElBQWdCLENBQUNWLEtBQUtXLE9BQUwsQ0FBYVIsRUFBRU8sS0FBZixHQUFqQjtRQUFBLE9BQU87O0lBQ1BELE1BQUFOLEVBQUFPLEtBQUE7SUFBQSxJQUFBSCxJQUFBLEdBQUFDLE1B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