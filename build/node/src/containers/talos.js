"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Talos = void 0;
var Meta = _interopRequireWildcard(require("@dashkite/joy/metaclass"));
var Type = _interopRequireWildcard(require("@dashkite/joy/type"));
var Value = _interopRequireWildcard(require("@dashkite/joy/value"));
var _states = require("../states.js");
var _generic = require("@dashkite/joy/generic");
var _helpers = require("../helpers.js");
var _errors = require("./errors.js");
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
var Talos, isError, isState, make;
isState = (0, _helpers.oneOf)([Type.isString, Type.isSymbol]);
isError = (0, _helpers.oneOf)([Type.isUndefined, _errors.TalosError.isType]);
make = (0, _generic.generic)({
  name: "talos make",
  default: function (...args) {
    throw new Error(`Talos.make: input is malformed ${JSON.stringify(args)}`);
  }
});
(0, _generic.generic)(make, isState, Type.isObject, isError, function (state, context, error) {
  return new Talos({
    state,
    context,
    error
  });
});
(0, _generic.generic)(make, function () {
  return make(_states.$start, {}, null);
});
(0, _generic.generic)(make, isState, Type.isObject, function (state, context) {
  return make(state, context, null);
});
(0, _generic.generic)(make, isState, function (state) {
  return make(state, {}, null);
});
(0, _generic.generic)(make, Type.isObject, function (context) {
  return make(_states.$start, context, null);
});
exports.Talos = Talos = function () {
  class Talos {
    constructor({
      state: state1,
      context: context1,
      error: error1
    }) {
      this.state = state1;
      this.context = context1;
      this.error = error1;
    }
    halt() {
      return this.state = _states.$halt;
    }
    throw(error) {
      this.halt();
      return this.error = error != null ? error : _errors.TalosError.make();
    }
    reset(state) {
      this.state = state != null ? state : _states.$start;
      this.context = {};
      return this.error = null;
    }
    clone() {
      var context;
      context = Value.clone(this.context);
      return new Talos({
        state: this.state,
        context,
        error: this.error
      });
    }
  }
  ;
  Meta.mixin(Talos.prototype, [Meta.getters({
    starting: function () {
      return (0, _states.atStart)(this.state);
    },
    halted: function () {
      return (0, _states.atHalt)(this.state);
    },
    paused: function () {
      return (0, _states.atPause)(this.state);
    },
    success: function () {
      return this.halted && this.error == null;
    },
    failure: function () {
      return this.halted && this.error != null;
    },
    running: function () {
      return !this.halted && !this.paused;
    }
  })]);
  Talos.make = make;
  Talos.isType = Type.isType(Talos);
  return Talos;
}.call(void 0);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jb250YWluZXJzL3RhbG9zLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBLElBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFDQSxJQUFBLElBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFDQSxJQUFBLEtBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFBQSxJQUFBLE9BQUEsR0FBQSxPQUFBO0FBRUEsSUFBQSxRQUFBLEdBQUEsT0FBQTtBQUFBLElBQUEsUUFBQSxHQUFBLE9BQUE7QUFBQSxJQUFBLE9BQUEsR0FBQSxPQUFBO0FBQUEsU0FBQSx5QkFBQSxDQUFBLDZCQUFBLE9BQUEsbUJBQUEsQ0FBQSxPQUFBLE9BQUEsSUFBQSxDQUFBLE9BQUEsT0FBQSxZQUFBLHdCQUFBLFlBQUEsQ0FBQSxDQUFBLFdBQUEsQ0FBQSxHQUFBLENBQUEsR0FBQSxDQUFBLEtBQUEsQ0FBQTtBQUFBLFNBQUEsd0JBQUEsQ0FBQSxFQUFBLENBQUEsU0FBQSxDQUFBLElBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxVQUFBLFNBQUEsQ0FBQSxlQUFBLENBQUEsdUJBQUEsQ0FBQSx5QkFBQSxDQUFBLFdBQUEsT0FBQSxFQUFBLENBQUEsUUFBQSxDQUFBLEdBQUEsd0JBQUEsQ0FBQSxDQUFBLE9BQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQSxVQUFBLENBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQSxPQUFBLENBQUEsS0FBQSxTQUFBLFVBQUEsQ0FBQSxHQUFBLE1BQUEsQ0FBQSxjQUFBLElBQUEsTUFBQSxDQUFBLHdCQUFBLFdBQUEsQ0FBQSxJQUFBLENBQUEsb0JBQUEsQ0FBQSxJQUFBLE1BQUEsQ0FBQSxTQUFBLENBQUEsY0FBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxTQUFBLENBQUEsR0FBQSxDQUFBLEdBQUEsTUFBQSxDQUFBLHdCQUFBLENBQUEsQ0FBQSxFQUFBLENBQUEsVUFBQSxDQUFBLEtB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TFQsQ0FERixDQURjLENBQWhCLENBQUE7RUFVQSxLQUFDLENBQUEsSUFBRCxHQUFPLElBQUE7RUFDUCxLQUFDLENBQUEsTUFBRCxHQUFTLElBQUksQ0FBQyxNQUFMLENBQVksS0FBWixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgTWV0YSBmcm9tIFwiQGRhc2hraXRlL2pveS9tZXRhY2xhc3NcIlxuaW1wb3J0ICogYXMgVHlwZSBmcm9tIFwiQGRhc2hraXRlL2pveS90eXBlXCJcbmltcG9ydCAqIGFzIFZhbHVlIGZyb20gXCJAZGFzaGtpdGUvam95L3ZhbHVlXCJcbmltcG9ydCB7ICRzdGFydCwgJGhhbHQsIGF0U3RhcnQsIGF0SGFsdCwgYXRQYXVzZSB9IGZyb20gXCIuLi9zdGF0ZXNcIlxuaW1wb3J0IHsgZ2VuZXJpYyB9IGZyb20gXCJAZGFzaGtpdGUvam95L2dlbmVyaWNcIlxuaW1wb3J0IHsgb25lT2YgfSBmcm9tIFwiLi4vaGVscGVyc1wiXG5pbXBvcnQgeyBUYWxvc0Vycm9yIH0gZnJvbSBcIi4vZXJyb3JzXCJcblxuXG5pc1N0YXRlID0gb25lT2YgW1xuICBUeXBlLmlzU3RyaW5nXG4gIFR5cGUuaXNTeW1ib2xcbl1cblxuaXNFcnJvciA9IG9uZU9mIFtcbiAgVHlwZS5pc1VuZGVmaW5lZFxuICBUYWxvc0Vycm9yLmlzVHlwZVxuXVxuXG5tYWtlID0gZ2VuZXJpYyBcbiAgbmFtZTogXCJ0YWxvcyBtYWtlXCJcbiAgZGVmYXVsdDogKCBhcmdzLi4uICkgLT4gXG4gICAgdGhyb3cgbmV3IEVycm9yIFwiVGFsb3MubWFrZTogaW5wdXQgaXMgbWFsZm9ybWVkICN7SlNPTi5zdHJpbmdpZnkgYXJnc31cIlxuXG5nZW5lcmljIG1ha2UsIGlzU3RhdGUsIFR5cGUuaXNPYmplY3QsIGlzRXJyb3IsICggc3RhdGUsIGNvbnRleHQsIGVycm9yICkgLT5cbiAgbmV3IFRhbG9zIHsgc3RhdGUsIGNvbnRleHQsIGVycm9yIH1cblxuZ2VuZXJpYyBtYWtlLCAtPlxuICBtYWtlICRzdGFydCwge30sIG51bGxcblxuZ2VuZXJpYyBtYWtlLCBpc1N0YXRlLCBUeXBlLmlzT2JqZWN0LCAoIHN0YXRlLCBjb250ZXh0ICkgLT5cbiAgbWFrZSBzdGF0ZSwgY29udGV4dCwgbnVsbFxuXG5nZW5lcmljIG1ha2UsIGlzU3RhdGUsICggc3RhdGUgKSAtPlxuICBtYWtlIHN0YXRlLCB7fSwgbnVsbFxuXG5nZW5lcmljIG1ha2UsIFR5cGUuaXNPYmplY3QsICggY29udGV4dCApIC0+XG4gIG1ha2UgJHN0YXJ0LCBjb250ZXh0LCBudWxsXG5cbmNsYXNzIFRhbG9zXG4gIGNvbnN0cnVjdG9yOiAoeyBAc3RhdGUsIEBjb250ZXh0LCBAZXJyb3IgfSkgLT5cblxuICBNZXRhLm1peGluIEA6OiwgW1xuICAgIE1ldGEuZ2V0dGVyc1xuICAgICAgc3RhcnRpbmc6IC0+IGF0U3RhcnQgQHN0YXRlXG4gICAgICBoYWx0ZWQ6IC0+IGF0SGFsdCBAc3RhdGVcbiAgICAgIHBhdXNlZDogLT4gYXRQYXVzZSBAc3RhdGVcbiAgICAgIHN1Y2Nlc3M6IC0+IEBoYWx0ZWQgJiYgIUBlcnJvcj9cbiAgICAgIGZhaWx1cmU6IC0+IEBoYWx0ZWQgJiYgQGVycm9yP1xuICAgICAgcnVubmluZzogLT4gIUBoYWx0ZWQgJiYgIUBwYXVzZWRcbiAgXVxuXG4gIEBtYWtlOiBtYWtlXG4gIEBpc1R5cGU6IFR5cGUuaXNUeXBlIEBcblxuICBoYWx0OiAtPlxuICAgIEBzdGF0ZSA9ICRoYWx0XG5cbiAgdGhyb3c6ICggZXJyb3IgKSAtPlxuICAgIEBoYWx0KClcbiAgICBAZXJyb3IgPSBlcnJvciA/IFRhbG9zRXJyb3IubWFrZSgpXG5cbiAgcmVzZXQ6ICggc3RhdGUgKSAtPlxuICAgIEBzdGF0ZSA9IHN0YXRlID8gJHN0YXJ0XG4gICAgQGNvbnRleHQgPSB7fVxuICAgIEBlcnJvciA9IG51bGxcblxuICBjbG9uZTogLT5cbiAgICBjb250ZXh0ID0gVmFsdWUuY2xvbmUgQGNvbnRleHRcbiAgICBuZXcgVGFsb3MgeyBAc3RhdGUsIGNvbnRleHQsIEBlcnJvciB9XG4gICAgICBcblxuZXhwb3J0IHtcbiAgVGFsb3Ncbn0iXSwic291cmNlUm9vdCI6IiJ9
//# sourceURL=src/containers/talos.coffee