"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Talos = void 0;
var Meta = _interopRequireWildcard(require("@dashkite/joy/metaclass"));
var Type = _interopRequireWildcard(require("@dashkite/joy/type"));
var Value = _interopRequireWildcard(require("@dashkite/joy/value"));
var _states = require("../internal/states.js");
var _generic = require("@dashkite/joy/generic");
var _helpers = require("../helpers.js");
var _errors = require("./errors.js");
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
var Talos, create, isError, isState;
isState = (0, _helpers.oneOf)([Type.isString, Type.isSymbol]);
isError = (0, _helpers.oneOf)([Type.isUndefined, _errors.TalosError.isType]);
create = (0, _generic.generic)({
  name: "talos create",
  default: function (...args) {
    throw new Error(`Talos.create: input is malformed ${JSON.stringify(args)}`);
  }
});
(0, _generic.generic)(create, isState, Type.isObject, isError, function (state, context, error) {
  return new Talos({
    state,
    context,
    error
  });
});
(0, _generic.generic)(create, function () {
  return create(_states.$start, {}, null);
});
(0, _generic.generic)(create, isState, Type.isObject, function (state, context) {
  return create(state, context, null);
});
(0, _generic.generic)(create, isState, function (state) {
  return create(state, {}, null);
});
(0, _generic.generic)(create, Type.isObject, function (context) {
  return create(_states.$start, context, null);
});
exports.Talos = Talos = function () {
  class Talos {
    constructor({
      state: state1,
      context: context1,
      error: error1
    }) {
      this.state = state1;
      this.context = context1;
      this.error = error1;
    }
    halt() {
      return this.state = _states.$halt;
    }
    throw(error) {
      this.halt();
      return this.error = error != null ? error : _errors.TalosError.create();
    }
    reset(state) {
      this.state = state != null ? state : _states.$start;
      this.context = {};
      return this.error = null;
    }
    clone() {
      var context;
      context = Value.clone(this.context);
      return new Talos({
        state: this.state,
        context,
        error: this.error
      });
    }
  }
  ;
  Meta.mixin(Talos.prototype, [Meta.getters({
    starting: function () {
      return (0, _states.atStart)(this.state);
    },
    halted: function () {
      return (0, _states.atHalt)(this.state);
    },
    paused: function () {
      return (0, _states.atPause)(this.state);
    },
    success: function () {
      return this.halted && this.error == null;
    },
    failure: function () {
      return this.halted && this.error != null;
    },
    running: function () {
      return !this.halted && !this.paused;
    }
  })]);
  Talos.create = create;
  Talos.isType = Type.isType(Talos);
  return Talos;
}.call(void 0);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jb250YWluZXJzL3RhbG9zLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBLElBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFDQSxJQUFBLElBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFDQSxJQUFBLEtBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFBQSxJQUFBLE9BQUEsR0FBQSxPQUFBO0FBRUEsSUFBQSxRQUFBLEdBQUEsT0FBQTtBQUFBLElBQUEsUUFBQSxHQUFBLE9BQUE7QUFBQSxJQUFBLE9BQUEsR0FBQSxPQUFBO0FBQUEsU0FBQSx5QkFBQSxDQUFBLDZCQUFBLE9BQUEsbUJBQUEsQ0FBQSxPQUFBLE9BQUEsSUFBQSxDQUFBLE9BQUEsT0FBQSxZQUFBLHdCQUFBLFlBQUEsQ0FBQSxDQUFBLFdBQUEsQ0FBQSxHQUFBLENBQUEsR0FBQSxDQUFBLEtBQUEsQ0FBQTtBQUFBLFNBQUEsd0JBQUEsQ0FBQSxFQUFBLENBQUEsU0FBQSxDQUFBLElBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxVQUFBLFNBQUEsQ0FBQSxlQUFBLENBQUEsdUJBQUEsQ0FBQSx5QkFBQSxDQUFBLFdBQUEsT0FBQSxFQUFBLENBQUEsUUFBQSxDQUFBLEdBQUEsd0JBQUEsQ0FBQSxDQUFBLE9BQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQSxVQUFBLENBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQSxPQUFBLENBQUEsS0FBQSxTQUFBLFVBQUEsQ0FBQSxHQUFBLE1BQUEsQ0FBQSxjQUFBLElBQUEsTUFBQSxDQUFBLHdCQUFBLFdBQUEsQ0FBQSxJQUFBLENBQUEsb0JBQUEsQ0FBQSxJQUFBLE1BQUEsQ0FBQSxTQUFBLENBQUEsY0FBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxTQUFBLENBQUEsR0FBQSxDQUFBLEdBQUEsTUFBQSxDQUFBLHdCQUFBLENBQUEsQ0FBQSxFQUFBLENBQUEsVUFBQSxDQUFBLEtB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O0lBQWpCO0VBTFQsQ0FERixDQURjLENBQWhCLENBQUE7RUFVQSxLQUFDLENBQUEsTUFBRCxHQUFTLE1BQUE7RUFDVCxLQUFDLENBQUEsTUFBRCxHQUFTLElBQUksQ0FBQyxNQUFMLENBQVksS0FBWixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgTWV0YSBmcm9tIFwiQGRhc2hraXRlL2pveS9tZXRhY2xhc3NcIlxuaW1wb3J0ICogYXMgVHlwZSBmcm9tIFwiQGRhc2hraXRlL2pveS90eXBlXCJcbmltcG9ydCAqIGFzIFZhbHVlIGZyb20gXCJAZGFzaGtpdGUvam95L3ZhbHVlXCJcbmltcG9ydCB7ICRzdGFydCwgJGhhbHQsIGF0U3RhcnQsIGF0SGFsdCwgYXRQYXVzZSB9IGZyb20gXCIuLi9pbnRlcm5hbC9zdGF0ZXNcIlxuaW1wb3J0IHsgZ2VuZXJpYyB9IGZyb20gXCJAZGFzaGtpdGUvam95L2dlbmVyaWNcIlxuaW1wb3J0IHsgb25lT2YgfSBmcm9tIFwiLi4vaGVscGVyc1wiXG5pbXBvcnQgeyBUYWxvc0Vycm9yIH0gZnJvbSBcIi4vZXJyb3JzXCJcblxuXG5pc1N0YXRlID0gb25lT2YgW1xuICBUeXBlLmlzU3RyaW5nXG4gIFR5cGUuaXNTeW1ib2xcbl1cblxuaXNFcnJvciA9IG9uZU9mIFtcbiAgVHlwZS5pc1VuZGVmaW5lZFxuICBUYWxvc0Vycm9yLmlzVHlwZVxuXVxuXG5jcmVhdGUgPSBnZW5lcmljIFxuICBuYW1lOiBcInRhbG9zIGNyZWF0ZVwiXG4gIGRlZmF1bHQ6ICggYXJncy4uLiApIC0+IFxuICAgIHRocm93IG5ldyBFcnJvciBcIlRhbG9zLmNyZWF0ZTogaW5wdXQgaXMgbWFsZm9ybWVkICN7SlNPTi5zdHJpbmdpZnkgYXJnc31cIlxuXG5nZW5lcmljIGNyZWF0ZSwgaXNTdGF0ZSwgVHlwZS5pc09iamVjdCwgaXNFcnJvciwgKCBzdGF0ZSwgY29udGV4dCwgZXJyb3IgKSAtPlxuICBuZXcgVGFsb3MgeyBzdGF0ZSwgY29udGV4dCwgZXJyb3IgfVxuXG5nZW5lcmljIGNyZWF0ZSwgLT5cbiAgY3JlYXRlICRzdGFydCwge30sIG51bGxcblxuZ2VuZXJpYyBjcmVhdGUsIGlzU3RhdGUsIFR5cGUuaXNPYmplY3QsICggc3RhdGUsIGNvbnRleHQgKSAtPlxuICBjcmVhdGUgc3RhdGUsIGNvbnRleHQsIG51bGxcblxuZ2VuZXJpYyBjcmVhdGUsIGlzU3RhdGUsICggc3RhdGUgKSAtPlxuICBjcmVhdGUgc3RhdGUsIHt9LCBudWxsXG5cbmdlbmVyaWMgY3JlYXRlLCBUeXBlLmlzT2JqZWN0LCAoIGNvbnRleHQgKSAtPlxuICBjcmVhdGUgJHN0YXJ0LCBjb250ZXh0LCBudWxsXG5cbmNsYXNzIFRhbG9zXG4gIGNvbnN0cnVjdG9yOiAoeyBAc3RhdGUsIEBjb250ZXh0LCBAZXJyb3IgfSkgLT5cblxuICBNZXRhLm1peGluIEA6OiwgW1xuICAgIE1ldGEuZ2V0dGVyc1xuICAgICAgc3RhcnRpbmc6IC0+IGF0U3RhcnQgQHN0YXRlXG4gICAgICBoYWx0ZWQ6IC0+IGF0SGFsdCBAc3RhdGVcbiAgICAgIHBhdXNlZDogLT4gYXRQYXVzZSBAc3RhdGVcbiAgICAgIHN1Y2Nlc3M6IC0+IEBoYWx0ZWQgJiYgIUBlcnJvcj9cbiAgICAgIGZhaWx1cmU6IC0+IEBoYWx0ZWQgJiYgQGVycm9yP1xuICAgICAgcnVubmluZzogLT4gIUBoYWx0ZWQgJiYgIUBwYXVzZWRcbiAgXVxuXG4gIEBjcmVhdGU6IGNyZWF0ZVxuICBAaXNUeXBlOiBUeXBlLmlzVHlwZSBAXG5cbiAgaGFsdDogLT5cbiAgICBAc3RhdGUgPSAkaGFsdFxuXG4gIHRocm93OiAoIGVycm9yICkgLT5cbiAgICBAaGFsdCgpXG4gICAgQGVycm9yID0gZXJyb3IgPyBUYWxvc0Vycm9yLmNyZWF0ZSgpXG5cbiAgcmVzZXQ6ICggc3RhdGUgKSAtPlxuICAgIEBzdGF0ZSA9IHN0YXRlID8gJHN0YXJ0XG4gICAgQGNvbnRleHQgPSB7fVxuICAgIEBlcnJvciA9IG51bGxcblxuICBjbG9uZTogLT5cbiAgICBjb250ZXh0ID0gVmFsdWUuY2xvbmUgQGNvbnRleHRcbiAgICBuZXcgVGFsb3MgeyBAc3RhdGUsIGNvbnRleHQsIEBlcnJvciB9XG4gICAgICBcblxuZXhwb3J0IHtcbiAgVGFsb3Ncbn0iXSwic291cmNlUm9vdCI6IiJ9
//# sourceURL=src/containers/talos.coffee