"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    Machine: function() {
        return Machine;
    },
    Vertex: function() {
        return Vertex;
    },
    Edges: function() {
        return Edges;
    },
    Edge: function() {
        return Edge;
    }
});
const _generic = require("@dashkite/joy/generic");
const _type = /*#__PURE__*/ _interop_require_wildcard(require("@dashkite/joy/type"));
const _states = require("./states");
function _getRequireWildcardCache(nodeInterop) {
    if (typeof WeakMap !== "function") return null;
    var cacheBabelInterop = new WeakMap();
    var cacheNodeInterop = new WeakMap();
    return (_getRequireWildcardCache = function(nodeInterop) {
        return nodeInterop ? cacheNodeInterop : cacheBabelInterop;
    })(nodeInterop);
}
function _interop_require_wildcard(obj, nodeInterop) {
    if (!nodeInterop && obj && obj.__esModule) {
        return obj;
    }
    if (obj === null || typeof obj !== "object" && typeof obj !== "function") {
        return {
            default: obj
        };
    }
    var cache = _getRequireWildcardCache(nodeInterop);
    if (cache && cache.has(obj)) {
        return cache.get(obj);
    }
    var newObj = {};
    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;
    for(var key in obj){
        if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) {
            var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;
            if (desc && (desc.get || desc.set)) {
                Object.defineProperty(newObj, key, desc);
            } else {
                newObj[key] = obj[key];
            }
        }
    }
    newObj.default = obj;
    if (cache) {
        cache.set(obj, newObj);
    }
    return newObj;
}
var Edge, Edges, Machine, Vertex, areVertexEdges, isState, normalizeMove, normalizeWhen, prioritize;
isState = function(x) {
    return _type.isString(x) || _type.isSymbol(x);
};
areVertexEdges = function(x) {
    var edge, j, len, ref;
    if (x.edges == null) {
        return false;
    }
    if (!_type.isArray(x.edges)) {
        return false;
    }
    ref = x.edges;
    for(j = 0, len = ref.length; j < len; j++){
        edge = ref[j];
        if (!_type.isObject(edge)) {
            return false;
        }
    }
    return true;
};
normalizeWhen = function(x) {
    if (isState(x)) {
        return function(talos, event) {
            return event === condition;
        };
    } else if (_type.isFunction(x)) {
        return x;
    } else if (_type.isBoolean(x)) {
        return function() {
            return x;
        };
    } else {
        throw new Error("unable to normalize when description");
    }
};
normalizeMove = function(x) {
    if (isState(x)) {
        return function(talos, event) {
            return talos.state = x;
        };
    } else if (_type.isFunction(x)) {
        return x;
    } else {
        throw new Error("unable to normalize move description");
    }
};
prioritize = function(frames) {
    return frames.sort(function(a, b) {
        if (a.priority < b.priority) {
            return -1;
        } else if (a.priority > b.priority) {
            return 1;
        } else {
            return 0;
        }
    });
};
Edge = {
    make: (0, _generic.generic)({
        name: "talos: make edge",
        default: function(...args) {
            throw new Error(`talos make edge: input is malformed ${JSON.stringify(args)}`);
        }
    })
};
(0, _generic.generic)(Edge.make, _type.isObject, function(object) {
    return {
        when: normalizeWhen(object.when),
        run: object.run,
        move: normalizeMove(object.move)
    };
});
(0, _generic.generic)(Edge.make, isState, _type.isAny, function(move, _when) {
    return Edge.make({
        move,
        when: _when
    });
});
(0, _generic.generic)(Edge.make, isState, _type.isObject, function(move, object) {
    var ref, ref1;
    return {
        when: normalizeWhen((ref = object.when) != null ? ref : true),
        run: object.run,
        move: normalizeMove((ref1 = object.move) != null ? ref1 : move)
    };
});
Edges = {
    make: (0, _generic.generic)({
        name: "talos: make edges",
        default: function(...args) {
            throw new Error(`talos make edges: input is malformed ${JSON.stringify(args)}`);
        }
    })
};
(0, _generic.generic)(Edges.make, _type.isObject, function(object) {
    var defaultFrame, edges, frames, j, k, key, len, len1, priority, ref, ref1, value;
    frames = [];
    defaultFrame = null;
    ref = Reflect.ownKeys(object);
    for(j = 0, len = ref.length; j < len; j++){
        key = ref[j];
        value = object[key];
        priority = (ref1 = value.priority) != null ? ref1 : 100;
        if (key === "default") {
            defaultFrame = {
                key,
                value
            };
        } else {
            if (key === "end") {
                key = _states.$end;
            }
            frames.push({
                key,
                value,
                priority
            });
        }
    }
    prioritize(frames);
    edges = [];
    for(k = 0, len1 = frames.length; k < len1; k++){
        ({ key, value } = frames[k]);
        edges.push(Edge.make(key, value));
    }
    if (defaultFrame != null) {
        // default is a special case emphasizing an always true "when" function.
        ({ value } = defaultFrame);
        if (_type.isObject(value)) {
            edges.push(Edge.make({
                ...value,
                when: true
            }));
        } else {
            edges.push(Edge.make({
                when: true,
                move: value
            }));
        }
    }
    return edges;
});
(0, _generic.generic)(Edges.make, _type.isArray, function(array) {
    var edge, j, len, results;
    results = [];
    for(j = 0, len = array.length; j < len; j++){
        edge = array[j];
        results.push(Edge.make(edge));
    }
    return results;
});
(0, _generic.generic)(Edges.make, _type.isFunction, function(f) {
    var edge;
    edge = {
        when: true,
        run: f,
        move: _states.$end
    };
    return [
        Edge.make(edge)
    ];
});
(0, _generic.generic)(Edges.make, isState, function(move) {
    return Edges.make({
        [move]: true
    });
});
(0, _generic.generic)(Edges.make, areVertexEdges, function({ edges }) {
    var edge, j, len, results;
    results = [];
    for(j = 0, len = edges.length; j < len; j++){
        edge = edges[j];
        results.push({
            when: edge.when,
            run: edge.run,
            move: edge.move
        });
    }
    return results;
});
Vertex = {
    make: function(key, value) {
        return {
            name: key,
            edges: Edges.make(value)
        };
    }
};
Machine = {
    make: function(value) {
        var _graph, j, key, len, machine, ref;
        _graph = Machine.format(value);
        machine = {
            graph: {}
        };
        ref = Reflect.ownKeys(_graph);
        for(j = 0, len = ref.length; j < len; j++){
            key = ref[j];
            value = _graph[key];
            machine.graph[key] = Vertex.make(key, value);
        }
        return machine;
    },
    format: function(value) {
        var _value, graph, j, key, len, ref;
        if (_type.isObject(value)) {
            graph = {};
            _value = value.graph != null ? value.graph : value;
            ref = Reflect.ownKeys(_value);
            for(j = 0, len = ref.length; j < len; j++){
                key = ref[j];
                graph[key] = _value[key];
            }
        } else if (_type.isArray(value)) {
            graph = Machine.expand(value);
        } else {
            throw new Error("Talos machine representation is malformed");
        }
        if (graph[_states.$start] == null) {
            if (graph.start != null) {
                graph[_states.$start] = graph.start;
                delete graph.start;
            } else {
                throw new Error("no start state defined for this machine");
            }
        }
        if (graph[_states.$end] == null) {
            if (graph.end != null) {
                graph[_states.$end] = graph.end;
                delete graph.end;
            }
        }
        return graph;
    },
    expand: function(fx) {
        var current, f, graph, i, j, len, next;
        graph = {};
        for(i = j = 0, len = fx.length; j < len; i = ++j){
            f = fx[i];
            current = i === 0 ? _states.$start : `${i}`;
            next = i === fx.length - 1 ? _states.$end : `${i + 1}`;
            graph[current] = {
                next: {
                    when: true,
                    run: f,
                    move: next
                }
            };
        }
        return graph;
    }
};
 //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL0BkYXNoa2l0ZS90YWxvcy9zcmMvbWFjaGluZS5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBQSxJQUFBLEVBQUEsS0FBQSxFQUFBLE9BQUEsRUFBQSxNQUFBLEVBQUEsY0FBQSxFQUFBLE9BQUEsRUFBQSxhQUFBLEVBQUEsYUFBQSxFQUFBOztBQUFBLE9BQUE7RUFBUyxPQUFUO0NBQUEsTUFBQTs7QUFDQSxPQUFPLENBQUEsUUFBUCxNQUFBOztBQUNBLE9BQUE7RUFBUyxNQUFUO0VBQWlCLElBQWpCO0NBQUEsTUFBQTs7QUFFQSxPQUFBLEdBQVUsUUFBQSxDQUFFLENBQUYsQ0FBQTtTQUFTLENBQUUsSUFBSSxDQUFDLFFBQUwsQ0FBYyxDQUFkLENBQUYsQ0FBQSxJQUF1QixDQUFFLElBQUksQ0FBQyxRQUFMLENBQWMsQ0FBZCxDQUFGO0FBQWhDOztBQUNWLGNBQUEsR0FBaUIsUUFBQSxDQUFFLENBQUYsQ0FBQTtBQUNqQixNQUFBLElBQUEsRUFBQSxDQUFBLEVBQUEsR0FBQSxFQUFBO0VBQUUsSUFBaUIsZUFBakI7QUFBQSxXQUFPLE1BQVA7O0VBQ0EsSUFBZ0IsQ0FBQyxJQUFJLENBQUMsT0FBTCxDQUFhLENBQUMsQ0FBQyxLQUFmLENBQWpCO0FBQUEsV0FBTyxNQUFQOztBQUNBO0VBQUEsS0FBQSxxQ0FBQTs7UUFBeUIsQ0FBQyxJQUFJLENBQUMsUUFBTCxDQUFjLElBQWQ7QUFDeEIsYUFBTzs7RUFEVDtTQUVBO0FBTGU7O0FBUWpCLGFBQUEsR0FBZ0IsUUFBQSxDQUFFLENBQUYsQ0FBQTtFQUNkLElBQUcsT0FBQSxDQUFRLENBQVIsQ0FBSDtXQUNFLFFBQUEsQ0FBRSxLQUFGLEVBQVMsS0FBVCxDQUFBO2FBQW9CLEtBQUEsS0FBUztJQUE3QixFQURGO0dBQUEsTUFFSyxJQUFHLElBQUksQ0FBQyxVQUFMLENBQWdCLENBQWhCLENBQUg7V0FDSCxFQURHO0dBQUEsTUFFQSxJQUFH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LEVBSlI7T0FERjs7SUFPQSxJQUFJLG1CQUFKO01BQ0UsSUFBRyxpQkFBSDtRQUNFLEtBQUssQ0FBRSxJQUFGLENBQUwsR0FBZ0IsS0FBSyxDQUFDO1FBQ3RCLE9BQU8sS0FBSyxDQUFDLElBRmY7T0FERjs7V0FLQTtFQXZCTSxDQVZSO0VBbUNBLE1BQUEsRUFBUSxRQUFBLENBQUUsRUFBRixDQUFBO0FBQ1YsUUFBQSxPQUFBLEVBQUEsQ0FBQSxFQUFBLEtBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQTtJQUFJLEtBQUEsR0FBUSxDQUFBO0lBQ1IsS0FBQSw0Q0FBQTs7TUFDRSxPQUFBLEdBQWEsQ0FBQSxLQUFLLENBQVIsR0FBZSxNQUFmLEdBQTJCLENBQUEsQ0FBQSxDQUFJLENBQUosQ0FBQTtNQUNyQyxJQUFBLEdBQVUsQ0FBQSxLQUFLLEVBQUUsQ0FBQyxNQUFILEdBQVksQ0FBcEIsR0FBMkIsSUFBM0IsR0FBcUMsQ0FBQSxDQUFBLENBQUksQ0FBQSxHQUFJLENBQVIsQ0FBQTtNQUU1QyxLQUFLLENBQUUsT0FBRixDQUFMLEdBQ0U7UUFBQSxJQUFBLEVBQ0U7VUFBQSxJQUFBLEVBQU0sSUFBTjtVQUNBLEdBQUEsRUFBSyxDQURMO1VBRUEsSUFBQSxFQUFNO1FBRk47TUFERjtJQUxKO1dBVUE7RUFaTTtBQW5DUjs7QUFrREYsT0FBQTtFQUFTLE9BQVQ7RUFBa0IsTUFBbEI7RUFBMEIsS0FBMUI7RUFBaUMsSUFBakMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZW5lcmljIH0gZnJvbSBcIkBkYXNoa2l0ZS9qb3kvZ2VuZXJpY1wiXG5pbXBvcnQgKiBhcyBUeXBlIGZyb20gXCJAZGFzaGtpdGUvam95L3R5cGVcIlxuaW1wb3J0IHsgJHN0YXJ0LCAkZW5kIH0gZnJvbSBcIi4vc3RhdGVzXCJcblxuaXNTdGF0ZSA9ICggeCApIC0+ICggVHlwZS5pc1N0cmluZyB4ICkgfHwgKCBUeXBlLmlzU3ltYm9sIHggKVxuYXJlVmVydGV4RWRnZXMgPSAoIHggKSAtPlxuICByZXR1cm4gZmFsc2UgaWYgIXguZWRnZXM/XG4gIHJldHVybiBmYWxzZSBpZiAhVHlwZS5pc0FycmF5IHguZWRnZXNcbiAgZm9yIGVkZ2UgaW4geC5lZGdlcyB3aGVuICFUeXBlLmlzT2JqZWN0IGVkZ2VcbiAgICByZXR1cm4gZmFsc2VcbiAgdHJ1ZVxuXG5cbm5vcm1hbGl6ZVdoZW4gPSAoIHggKSAtPlxuICBpZiBpc1N0YXRlIHhcbiAgICAoIHRhbG9zLCBldmVudCApIC0+IGV2ZW50ID09IGNvbmRpdGlvblxuICBlbHNlIGlmIFR5cGUuaXNGdW5jdGlvbiB4XG4gICAgeFxuICBlbHNlIGlmIFR5cGUuaXNCb29sZWFuIHhcbiAgICAtPiB4XG4gIGVsc2VcbiAgICB0aHJvdyBuZXcgRXJyb3IgXCJ1bmFibGUgdG8gbm9ybWFsaXplIHdoZW4gZGVzY3JpcHRpb25cIlxuXG5ub3JtYWxpemVNb3ZlID0gKCB4ICkgLT5cbiAgaWYgaXNTdGF0ZSB4XG4gICAgKCB0YWxvcywgZXZlbnQgKSAtPiB0YWxvcy5zdGF0ZSA9IHhcbiAgZWxzZSBpZiBUeXBlLmlzRnVuY3Rpb24geFxuICAgIHhcbiAgZWxzZVxuICAgIHRocm93IG5ldyBFcnJvciBcInVuYWJsZSB0byBub3JtYWxpemUgbW92ZSBkZXNjcmlwdGlvblwiXG5cbnByaW9yaXRpemUgPSAoIGZyYW1lcyApIC0+XG4gIGZyYW1lcy5zb3J0ICggYSwgYiApIC0+IFxuICAgIGlmIGEucHJpb3JpdHkgPCBiLnByaW9yaXR5XG4gICAgICAtMVxuICAgIGVsc2UgaWYgYS5wcmlvcml0eSA+IGIucHJpb3JpdHlcbiAgICAgIDFcbiAgICBlbHNlXG4gICAgICAwXG5cblxuRWRnZSA9XG4gIG1ha2U6IGdlbmVyaWMgXG4gICAgbmFtZTogXCJ0YWxvczogbWFrZSBlZGdlXCJcbiAgICBkZWZhdWx0OiAoIGFyZ3MuLi4gKSAtPiBcbiAgICAgIHRocm93IG5ldyBFcnJvciBcInRhbG9zIG1ha2UgZWRnZTogaW5wdXQgaXMgbWFsZm9ybWVkICN7IEpTT04uc3RyaW5naWZ5IGFyZ3MgfVwiXG5cbmdlbmVyaWMgRWRnZS5tYWtlLCBUeXBlLmlzT2JqZWN0LCAoIG9iamVjdCApIC0+XG4gIHdoZW46IG5vcm1hbGl6ZVdoZW4gb2JqZWN0LndoZW5cbiAgcnVuOiBvYmplY3QucnVuXG4gIG1vdmU6IG5vcm1hbGl6ZU1vdmUgb2JqZWN0Lm1vdmVcblxuZ2VuZXJpYyBFZGdlLm1ha2UsIGlzU3RhdGUsIFR5cGUuaXNBbnksICggbW92ZSwgX3doZW4gKSAtPlxuICBFZGdlLm1ha2UgeyBtb3ZlLCB3aGVuOiBfd2hlbiB9XG5cbmdlbmVyaWMgRWRnZS5tYWtlLCBpc1N0YXRlLCBUeXBlLmlzT2JqZWN0LCAoIG1vdmUsIG9iamVjdCApIC0+XG4gIHdoZW46IG5vcm1hbGl6ZVdoZW4gb2JqZWN0LndoZW4gPyB0cnVlXG4gIHJ1bjogb2JqZWN0LnJ1blxuICBtb3ZlOiBub3JtYWxpemVNb3ZlIG9iamVjdC5tb3ZlID8gbW92ZVxuXG5cbkVkZ2VzID0gXG4gIG1ha2U6IGdlbmVyaWMgXG4gICAgbmFtZTogXCJ0YWxvczogbWFrZSBlZGdlc1wiXG4gICAgZGVmYXVsdDogKCBhcmdzLi4uICkgLT4gXG4gICAgICB0aHJvdyBuZXcgRXJyb3IgXCJ0YWxvcyBtYWtlIGVkZ2VzOiBpbnB1dCBpcyBtYWxmb3JtZWQgI3sgSlNPTi5zdHJpbmdpZnkgYXJncyB9XCJcblxuZ2VuZXJpYyBFZGdlcy5tYWtlLCBUeXBlLmlzT2JqZWN0LCAoIG9iamVjdCApIC0+XG4gIGZyYW1lcyA9IFtdXG4gIGRlZmF1bHRGcmFtZSA9IG51bGxcbiAgZm9yIGtleSBpbiBSZWZsZWN0Lm93bktleXMgb2JqZWN0XG4gICAgdmFsdWUgPSBvYmplY3RbIGtleSBdXG4gICAgcHJpb3JpdHkgPSB2YWx1ZS5wcmlvcml0eSA/IDEwMFxuICAgIGlmIGtleSA9PSBcImRlZmF1bHRcIlxuICAgICAgZGVmYXVsdEZyYW1lID0geyBrZXksIHZhbHVlIH1cbiAgICBlbHNlXG4gICAgICBrZXkgPSAkZW5kIGlmIGtleSA9PSBcImVuZFwiXG4gICAgICBmcmFtZXMucHVzaCB7IGtleSwgdmFsdWUsIHByaW9yaXR5IH1cblxuICBwcmlvcml0aXplIGZyYW1lc1xuXG4gIGVkZ2VzID0gW11cbiAgZm9yIHsga2V5LCB2YWx1ZSB9IGluIGZyYW1lc1xuICAgIGVkZ2VzLnB1c2ggRWRnZS5tYWtlIGtleSwgdmFsdWVcblxuICBpZiBkZWZhdWx0RnJhbWU/XG4gICAgIyBkZWZhdWx0IGlzIGEgc3BlY2lhbCBjYXNlIGVtcGhhc2l6aW5nIGFuIGFsd2F5cyB0cnVlIFwid2hlblwiIGZ1bmN0aW9uLlxuICAgIHsgdmFsdWUgfSA9IGRlZmF1bHRGcmFtZVxuICAgIGlmIFR5cGUuaXNPYmplY3QgdmFsdWVcbiAgICAgIGVkZ2VzLnB1c2ggRWRnZS5tYWtlIHsgdmFsdWUuLi4sIHdoZW46IHRydWUgfVxuICAgIGVsc2VcbiAgICAgIGVkZ2VzLnB1c2ggRWRnZS5tYWtlIHdoZW46IHRydWUsIG1vdmU6IHZhbHVlXG4gIFxuICBlZGdlc1xuICBcblxuZ2VuZXJpYyBFZGdlcy5tYWtlLCBUeXBlLmlzQXJyYXksICggYXJyYXkgKSAtPlxuICBmb3IgZWRnZSBpbiBhcnJheVxuICAgIEVkZ2UubWFrZSBlZGdlXG5cbmdlbmVyaWMgRWRnZXMubWFrZSwgVHlwZS5pc0Z1bmN0aW9uLCAoIGYgKSAtPlxuICBlZGdlID0gd2hlbjogdHJ1ZSwgcnVuOiBmLCBtb3ZlOiAkZW5kXG4gIFsgRWRnZS5tYWtlIGVkZ2UgXVxuXG5nZW5lcmljIEVkZ2VzLm1ha2UsIGlzU3RhdGUsICggbW92ZSApIC0+XG4gIEVkZ2VzLm1ha2UgWyBtb3ZlIF06IHRydWVcblxuZ2VuZXJpYyBFZGdlcy5tYWtlLCBhcmVWZXJ0ZXhFZGdlcywgKHsgZWRnZXMgfSkgLT5cbiAgZm9yIGVkZ2UgaW4gZWRnZXNcbiAgICB3aGVuOiBlZGdlLndoZW5cbiAgICBydW46IGVkZ2UucnVuXG4gICAgbW92ZTogZWRnZS5tb3ZlXG5cblxuVmVydGV4ID1cbiAgbWFrZTogKCBrZXksIHZhbHVlICkgLT5cbiAgICBuYW1lOiBrZXlcbiAgICBlZGdlczogRWRnZXMubWFrZSB2YWx1ZVxuXG5cbk1hY2hpbmUgPVxuICBtYWtlOiAoIHZhbHVlICkgLT4gXG4gICAgX2dyYXBoID0gTWFjaGluZS5mb3JtYXQgdmFsdWVcbiAgICBtYWNoaW5lID0gZ3JhcGg6IHt9XG5cbiAgICBmb3Iga2V5IGluIFJlZmxlY3Qub3duS2V5cyBfZ3JhcGhcbiAgICAgIHZhbHVlID0gX2dyYXBoWyBrZXkgXVxuICAgICAgbWFjaGluZS5ncmFwaFsga2V5IF0gPSBWZXJ0ZXgubWFrZSBrZXksIHZhbHVlXG4gICAgXG4gICAgbWFjaGluZVxuXG4gIGZvcm1hdDogKCB2YWx1ZSApIC0+XG4gICAgaWYgVHlwZS5pc09iamVjdCB2YWx1ZVxuICAgICAgZ3JhcGggPSB7fVxuICAgICAgX3ZhbHVlID0gaWYgdmFsdWUuZ3JhcGg/IHRoZW4gdmFsdWUuZ3JhcGggZWxzZSB2YWx1ZVxuICAgICAgZm9yIGtleSBpbiBSZWZsZWN0Lm93bktleXMgX3ZhbHVlXG4gICAgICAgIGdyYXBoWyBrZXkgXSA9IF92YWx1ZVsga2V5IF1cbiAgICBlbHNlIGlmIFR5cGUuaXNBcnJheSB2YWx1ZVxuICAgICAgZ3JhcGggPSBNYWNoaW5lLmV4cGFuZCB2YWx1ZVxuICAgIGVsc2VcbiAgICAgIHRocm93IG5ldyBFcnJvciBcIlRhbG9zIG1hY2hpbmUgcmVwcmVzZW50YXRpb24gaXMgbWFsZm9ybWVkXCJcbiAgICBcbiAgICBpZiAhZ3JhcGhbICRzdGFydCBdP1xuICAgICAgaWYgZ3JhcGguc3RhcnQ/XG4gICAgICAgIGdyYXBoWyAkc3RhcnQgXSA9IGdyYXBoLnN0YXJ0XG4gICAgICAgIGRlbGV0ZSBncmFwaC5zdGFydFxuICAgICAgZWxzZVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IgXCJubyBzdGFydCBzdGF0ZSBkZWZpbmVkIGZvciB0aGlzIG1hY2hpbmVcIlxuXG4gICAgaWYgIWdyYXBoWyAkZW5kIF0/XG4gICAgICBpZiBncmFwaC5lbmQ/XG4gICAgICAgIGdyYXBoWyAkZW5kIF0gPSBncmFwaC5lbmRcbiAgICAgICAgZGVsZXRlIGdyYXBoLmVuZFxuXG4gICAgZ3JhcGhcblxuICBleHBhbmQ6ICggZnggKSAtPlxuICAgIGdyYXBoID0ge30gICAgXG4gICAgZm9yIGYsIGkgaW4gZnhcbiAgICAgIGN1cnJlbnQgPSBpZiBpID09IDAgdGhlbiAkc3RhcnQgZWxzZSBcIiN7IGkgfVwiXG4gICAgICBuZXh0ID0gaWYgaSA9PSBmeC5sZW5ndGggLSAxIHRoZW4gJGVuZCBlbHNlIFwiI3sgaSArIDEgfVwiXG5cbiAgICAgIGdyYXBoWyBjdXJyZW50IF0gPSBcbiAgICAgICAgbmV4dDpcbiAgICAgICAgICB3aGVuOiB0cnVlXG4gICAgICAgICAgcnVuOiBmXG4gICAgICAgICAgbW92ZTogbmV4dFxuICAgIFxuICAgIGdyYXBoXG5cblxuZXhwb3J0IHsgTWFjaGluZSwgVmVydGV4LCBFZGdlcywgRWRnZSB9Il19
 //# sourceURL=/@dashkite/talos/src/machine.coffee

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9AZGFzaGtpdGUvdGFsb3Mvc3JjL21hY2hpbmUuY29mZmVlIiwiPGFub24+Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdlbmVyaWMgfSBmcm9tIFwiQGRhc2hraXRlL2pveS9nZW5lcmljXCJcbmltcG9ydCAqIGFzIFR5cGUgZnJvbSBcIkBkYXNoa2l0ZS9qb3kvdHlwZVwiXG5pbXBvcnQgeyAkc3RhcnQsICRlbmQgfSBmcm9tIFwiLi9zdGF0ZXNcIlxuXG5pc1N0YXRlID0gKCB4ICkgLT4gKCBUeXBlLmlzU3RyaW5nIHggKSB8fCAoIFR5cGUuaXNTeW1ib2wgeCApXG5hcmVWZXJ0ZXhFZGdlcyA9ICggeCApIC0+XG4gIHJldHVybiBmYWxzZSBpZiAheC5lZGdlcz9cbiAgcmV0dXJuIGZhbHNlIGlmICFUeXBlLmlzQXJyYXkgeC5lZGdlc1xuICBmb3IgZWRnZSBpbiB4LmVkZ2VzIHdoZW4gIVR5cGUuaXNPYmplY3QgZWRnZVxuICAgIHJldHVybiBmYWxzZVxuICB0cnVlXG5cblxubm9ybWFsaXplV2hlbiA9ICggeCApIC0+XG4gIGlmIGlzU3RhdGUgeFxuICAgICggdGFsb3MsIGV2ZW50ICkgLT4gZXZlbnQgPT0gY29uZGl0aW9uXG4gIGVsc2UgaWYgVHlwZS5pc0Z1bmN0aW9uIHhcbiAgICB4XG4gIGVsc2UgaWYgVHlwZS5pc0Jvb2xlYW4geFxuICAgIC0+IHhcbiAgZWxzZVxuICAgIHRocm93IG5ldyBFcnJvciBcInVuYWJsZSB0byBub3JtYWxpemUgd2hlbiBkZXNjcmlwdGlvblwiXG5cbm5vcm1hbGl6ZU1vdmUgPSAoIHggKSAtPlxuICBpZiBpc1N0YXRlIHhcbiAgICAoIHRhbG9zLCBldmVudCApIC0+IHRhbG9zLnN0YXRlID0geFxuICBlbHNlIGlmIFR5cGUuaXNGdW5jdGlvbiB4XG4gICAgeFxuICBlbHNlXG4gICAgdGhyb3cgbmV3IEVycm9yIFwidW5hYmxlIHRvIG5vcm1hbGl6ZSBtb3ZlIGRlc2NyaXB0aW9uXCJcblxucHJpb3JpdGl6ZSA9ICggZnJhbWVzICkgLT5cbiAgZnJhbWVzLnNvcnQgKCBhLCBiICkgLT4gXG4gICAgaWYgYS5wcmlvcml0eSA8IGIucHJpb3JpdHlcbiAgICAgIC0xXG4gICAgZWxzZSBpZiBhLnByaW9yaXR5ID4gYi5wcmlvcml0eVxuICAgICAgMVxuICAgIGVsc2VcbiAgICAgIDBcblxuXG5FZGdlID1cbiAgbWFrZTogZ2VuZXJpYyBcbiAgICBuYW1lOiBcInRhbG9zOiBtYWtlIGVkZ2VcIlxuICAgIGRlZmF1bHQ6ICggYXJncy4uLiApIC0+IFxuICAgICAgdGhyb3cgbmV3IEVycm9yIFwidGFsb3MgbWFrZSBlZGdlOiBpbnB1dCBpcyBtYWxmb3JtZWQgI3sgSlNPTi5zdHJpbmdpZnkgYXJncyB9XCJcblxuZ2VuZXJpYyBFZGdlLm1ha2UsIFR5cGUuaXNPYmplY3QsICggb2JqZWN0ICkgLT5cbiAgd2hlbjogbm9ybWFsaXplV2hlbiBvYmplY3Qud2hlblxuICBydW46IG9iamVjdC5ydW5cbiAgbW92ZTogbm9ybWFsaXplTW92ZSBvYmplY3QubW92ZVxuXG5nZW5lcmljIEVkZ2UubWFrZSwgaXNTdGF0ZSwgVHlwZS5pc0FueSwgKCBtb3ZlLCBfd2hlbiApIC0+XG4gIEVkZ2UubWFrZSB7IG1vdmUsIHdoZW46IF93aGVuIH1cblxuZ2VuZXJpYyBFZGdlLm1ha2UsIGlzU3RhdGUsIFR5cGUuaXNPYmplY3QsICggbW92ZSwgb2JqZWN0ICkgLT5cbiAgd2hlbjogbm9ybWFsaXplV2hlbiBvYmplY3Qud2hlbiA/IHRydWVcbiAgcnVuOiBvYmplY3QucnVuXG4gIG1vdmU6IG5vcm1hbGl6ZU1vdmUgb2JqZWN0Lm1vdmUgPyBtb3ZlXG5cblxuRWRnZXMgPSBcbiAgbWFrZTogZ2VuZXJpYyBcbiAgICBuYW1lOiBcInRhbG9zOiBtYWtlIGVkZ2VzXCJcbiAgICBkZWZhdWx0OiAoIGFyZ3MuLi4gKSAtPiBcbiAgICAgIHRocm93IG5ldyBFcnJvciBcInRhbG9zIG1ha2UgZWRnZXM6IGlucHV0IGlzIG1hbGZvcm1lZCAjeyBKU09OLnN0cmluZ2lmeSBhcmdzIH1cIlxuXG5nZW5lcmljIEVkZ2VzLm1ha2UsIFR5cGUuaXNPYmplY3QsICggb2JqZWN0ICkgLT5cbiAgZnJhbWVzID0gW11cbiAgZGVmYXVsdEZyYW1lID0gbnVsbFxuICBmb3Iga2V5IGluIFJlZmxlY3Qub3duS2V5cyBvYmplY3RcbiAgICB2YWx1ZSA9IG9iamVjdFsga2V5IF1cbiAgICBwcmlvcml0eSA9IHZhbHVlLnByaW9yaXR5ID8gMTAwXG4gICAgaWYga2V5ID09IFwiZGVmYXVsdFwiXG4gICAgICBkZWZhdWx0RnJhbWUgPSB7IGtleSwgdmFsdWUgfVxuICAgIGVsc2VcbiAgICAgIGtleSA9ICRlbmQgaWYga2V5ID09IFwiZW5kXCJcbiAgICAgIGZyYW1lcy5wdXNoIHsga2V5LCB2YWx1ZSwgcHJpb3JpdHkgfVxuXG4gIHByaW9yaXRpemUgZnJhbWVzXG5cbiAgZWRnZXMgPSBbXVxuICBmb3IgeyBrZXksIHZhbHVlIH0gaW4gZnJhbWVzXG4gICAgZWRnZXMucHVzaCBFZGdlLm1ha2Uga2V5LCB2YWx1ZVxuXG4gIGlmIGRlZmF1bHRGcmFtZT9cbiAgICAjIGRlZmF1bHQgaXMgYSBzcGVjaWFsIGNhc2UgZW1waGFzaXppbmcgYW4gYWx3YXlzIHRydWUgXCJ3aGVuXCIgZnVuY3Rpb24uXG4gICAgeyB2YWx1ZSB9ID0gZGVmYXVsdEZyYW1lXG4gICAgaWYgVHlwZS5pc09iamVjdCB2YWx1ZVxuICAgICAgZWRnZXMucHVzaCBFZGdlLm1ha2UgeyB2YWx1ZS4uLiwgd2hlbjogdHJ1ZSB9XG4gICAgZWxzZVxuICAgICAgZWRnZXMucHVzaCBFZGdlLm1ha2Ugd2hlbjogdHJ1ZSwgbW92ZTogdmFsdWVcbiAgXG4gIGVkZ2VzXG4gIFxuXG5nZW5lcmljIEVkZ2VzLm1ha2UsIFR5cGUuaXNBcnJheSwgKCBhcnJheSApIC0+XG4gIGZvciBlZGdlIGluIGFycmF5XG4gICAgRWRnZS5tYWtlIGVkZ2VcblxuZ2VuZXJpYyBFZGdlcy5tYWtlLCBUeXBlLmlzRnVuY3Rpb24sICggZiApIC0+XG4gIGVkZ2UgPSB3aGVuOiB0cnVlLCBydW46IGYsIG1vdmU6ICRlbmRcbiAgWyBFZGdlLm1ha2UgZWRnZSBdXG5cbmdlbmVyaWMgRWRnZXMubWFrZSwgaXNTdGF0ZSwgKCBtb3ZlICkgLT5cbiAgRWRnZXMubWFrZSBbIG1vdmUgXTogdHJ1ZVxuXG5nZW5lcmljIEVkZ2VzLm1ha2UsIGFyZVZlcnRleEVkZ2VzLCAoeyBlZGdlcyB9KSAtPlxuICBmb3IgZWRnZSBpbiBlZGdlc1xuICAgIHdoZW46IGVkZ2Uud2hlblxuICAgIHJ1bjogZWRnZS5ydW5cbiAgICBtb3ZlOiBlZGdlLm1vdmVcblxuXG5WZXJ0ZXggPVxuICBtYWtlOiAoIGtleSwgdmFsdWUgKSAtPlxuICAgIG5hbWU6IGtleVxuICAgIGVkZ2VzOiBFZGdlcy5tYWtlIHZhbHVlXG5cblxuTWFjaGluZSA9XG4gIG1ha2U6ICggdmFsdWUgKSAtPiBcbiAgICBfZ3JhcGggPSBNYWNoaW5lLmZvcm1hdCB2YWx1ZVxuICAgIG1hY2hpbmUgPSBncmFwaDoge31cblxuICAgIGZvciBrZXkgaW4gUmVmbGVjdC5vd25LZXlzIF9ncmFwaFxuICAgICAgdmFsdWUgPSBfZ3JhcGhbIGtleSBdXG4gICAgICBtYWNoaW5lLmdyYXBoWyBrZXkgXSA9IFZlcnRleC5tYWtlIGtleSwgdmFsdWVcbiAgICBcbiAgICBtYWNoaW5lXG5cbiAgZm9ybWF0OiAoIHZhbHVlICkgLT5cbiAgICBpZiBUeXBlLmlzT2JqZWN0IHZhbHVlXG4gICAgICBncmFwaCA9IHt9XG4gICAgICBfdmFsdWUgPSBpZiB2YWx1ZS5ncmFwaD8gdGhlbiB2YWx1ZS5ncmFwaCBlbHNlIHZhbHVlXG4gICAgICBmb3Iga2V5IGluIFJlZmxlY3Qub3duS2V5cyBfdmFsdWVcbiAgICAgICAgZ3JhcGhbIGtleSBdID0gX3ZhbHVlWyBrZXkgXVxuICAgIGVsc2UgaWYgVHlwZS5pc0FycmF5IHZhbHVlXG4gICAgICBncmFwaCA9IE1hY2hpbmUuZXhwYW5kIHZhbHVlXG4gICAgZWxzZVxuICAgICAgdGhyb3cgbmV3IEVycm9yIFwiVGFsb3MgbWFjaGluZSByZXByZXNlbnRhdGlvbiBpcyBtYWxmb3JtZWRcIlxuICAgIFxuICAgIGlmICFncmFwaFsgJHN0YXJ0IF0/XG4gICAgICBpZiBncmFwaC5zdGFydD9cbiAgICAgICAgZ3JhcGhbICRzdGFydCBdID0gZ3JhcGguc3RhcnRcbiAgICAgICAgZGVsZXRlIGdyYXBoLnN0YXJ0XG4gICAgICBlbHNlXG4gICAgICAgIHRocm93IG5ldyBFcnJvciBcIm5vIHN0YXJ0IHN0YXRlIGRlZmluZWQgZm9yIHRoaXMgbWFjaGluZVwiXG5cbiAgICBpZiAhZ3JhcGhbICRlbmQgXT9cbiAgICAgIGlmIGdyYXBoLmVuZD9cbiAgICAgICAgZ3JhcGhbICRlbmQgXSA9IGdyYXBoLmVuZFxuICAgICAgICBkZWxldGUgZ3JhcGguZW5kXG5cbiAgICBncmFwaFxuXG4gIGV4cGFuZDogKCBmeCApIC0+XG4gICAgZ3JhcGggPSB7fSAgICBcbiAgICBmb3IgZiwgaSBpbiBmeFxuICAgICAgY3VycmVudCA9IGlmIGkgPT0gMCB0aGVuICRzdGFydCBlbHNlIFwiI3sgaSB9XCJcbiAgICAgIG5leHQgPSBpZiBpID09IGZ4Lmxlbmd0aCAtIDEgdGhlbiAkZW5kIGVsc2UgXCIjeyBpICsgMSB9XCJcblxuICAgICAgZ3JhcGhbIGN1cnJlbnQgXSA9IFxuICAgICAgICBuZXh0OlxuICAgICAgICAgIHdoZW46IHRydWVcbiAgICAgICAgICBydW46IGZcbiAgICAgICAgICBtb3ZlOiBuZXh0XG4gICAgXG4gICAgZ3JhcGhcblxuXG5leHBvcnQgeyBNYWNoaW5lLCBWZXJ0ZXgsIEVkZ2VzLCBFZGdlIH0iLG51bGxdLCJuYW1lcyI6WyJNYWNoaW5lIiwiVmVydGV4IiwiRWRnZXMiLCJFZGdlIiwiYXJlVmVydGV4RWRnZXMiLCJpc1N0YXRlIiwibm9ybWFsaXplTW92ZSIsIm5vcm1hbGl6ZVdoZW4iLCJwcmlvcml0aXplIiwieCIsIlR5cGUiLCJpc1N0cmluZyIsImlzU3ltYm9sIiwiZWRnZSIsImoiLCJsZW4iLCJyZWYiLCJlZGdlcyIsImlzQXJyYXkiLCJsZW5ndGgiLCJpc09iamVjdCIsInRhbG9zIiwiZXZlbnQiLCJjb25kaXRpb24iLCJpc0Z1bmN0aW9uIiwiaXNCb29sZWFuIiwiRXJyb3IiLCJzdGF0ZSIsImZyYW1lcyIsInNvcnQiLCJhIiwiYiIsInByaW9yaXR5IiwibWFrZSIsImdlbmVyaWMiLCJuYW1lIiwiZGVmYXVsdCIsImFyZ3MiLCJKU09OIiwic3RyaW5naWZ5Iiwib2JqZWN0Iiwid2hlbiIsInJ1biIsIm1vdmUiLCJpc0FueSIsIl93aGVuIiwicmVmMSIsImRlZmF1bHRGcmFtZSIsImsiLCJrZXkiLCJsZW4xIiwidmFsdWUiLCJSZWZsZWN0Iiwib3duS2V5cyIsIiRlbmQiLCJwdXNoIiwiYXJyYXkiLCJyZXN1bHRzIiwiZiIsIl9ncmFwaCIsIm1hY2hpbmUiLCJmb3JtYXQiLCJncmFwaCIsIl92YWx1ZSIsImV4cGFuZCIsIiRzdGFydCIsInN0YXJ0IiwiZW5kIiwiZngiLCJjdXJyZW50IiwiaSIsIm5leHQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0lBMktTQSxPQUFUO2VBQVNBOztJQUFTQyxNQUFsQjtlQUFrQkE7O0lBQVFDLEtBQTFCO2VBQTBCQTs7SUFBT0MsSUFBakM7ZUFBaUNBOzs7eUJBM0tqQzs4REFDQTt3QkFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUZBLElBQUFBLE1BQUFELE9BQUFGLFNBQUFDLFFBQUFHLGdCQUFBQyxTQUFBQyxlQUFBQyxlQUFBQztBQUlBSCxVQUFVLFNBQUVJLENBQUY7V0FBUyxBQUFFQyxNQUFLQyxRQUFMLENBQWNGLE1BQVNDLE1BQUtFLFFBQUwsQ0FBY0g7QUFBaEQ7QUFDVkwsaUJBQWlCLFNBQUVLLENBQUY7SUFDakIsSUFBQUksTUFBQUMsR0FBQUMsS0FBQUM7SUFBRSxJQUFpQlAsRUFBQVEsS0FBQSxJQUFBLE1BQWpCO1FBQUEsT0FBTzs7SUFDUCxJQUFnQixDQUFDUCxNQUFLUSxPQUFM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