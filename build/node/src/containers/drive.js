"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Drive = void 0;
var Meta = _interopRequireWildcard(require("@dashkite/joy/metaclass"));
var Type = _interopRequireWildcard(require("@dashkite/joy/type"));
var Value = _interopRequireWildcard(require("@dashkite/joy/value"));
var _generic = require("@dashkite/joy/generic");
var _graph = require("./graph.js");
var _talos = require("./talos.js");
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
var Drive, make;
make = (0, _generic.generic)({
  name: "drive make",
  default: function (...args) {
    throw new Error(`Drive.make: input is malformed ${JSON.stringify(args)}`);
  }
});
(0, _generic.generic)(make, _graph.Graph.isType, _talos.Talos.isType, Type.isFunction, function (graph, talos, step) {
  return new Drive({
    graph,
    talos,
    step
  });
});
exports.Drive = Drive = function () {
  class Drive {
    constructor({
      graph: graph1,
      talos: talos1,
      step: step1
    }) {
      this.graph = graph1;
      this.talos = talos1;
      this.step = step1;
    }
    update(...transforms) {
      return this.step(this.graph, this.talos, ...transforms);
    }
  }
  ;
  Meta.mixin(Drive.prototype, [Meta.getters({
    state: function () {
      return this.talos.state;
    },
    isSync: function () {
      return Type.isRegularFunction(this.step);
    }
  })]);
  Drive.make = make;
  Drive.isType = Type.isType(Drive);
  return Drive;
}.call(void 0);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jb250YWluZXJzL2RyaXZlLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBLElBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFDQSxJQUFBLElBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFDQSxJQUFBLEtBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFDQSxJQUFBLFFBQUEsR0FBQSxPQUFBO0FBQUEsSUFBQSxNQUFBLEdBQUEsT0FBQTtBQUFBLElBQUEsTUFBQSxHQUFBLE9BQUE7QUFBQSxTQUFBLHlCQUFBLENBQUEsNkJBQUEsT0FBQSxtQkFBQSxDQUFBLE9BQUEsT0FBQSxJQUFBLENBQUEsT0FBQSxPQUFBLFlBQUEsd0JBQUEsWUFBQSxDQUFBLENBQUEsV0FBQSxDQUFBLEdBQUEsQ0FBQSxHQUFBLENBQUEsS0FBQSxDQUFBO0FBQUEsU0FBQSx3QkFBQSxDQUFBLEVBQUEsQ0FBQSxTQUFBLENBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLFVBQUEsU0FBQSxDQUFBLGVBQUEsQ0FBQSx1QkFBQSxDQUFBLHlCQUFBLENBQUEsV0FBQSxPQUFBLEVBQUEsQ0FBQSxRQUFBLENBQUEsR0FBQSx3QkFBQSxDQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBLFVBQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBLE9BQUEsQ0FBQSxLQUFBLFNBQUEsVUFBQSxDQUFBLEdBQUEsTUFBQSxDQUFBLGNBQUEsSUFBQSxNQUFBLENBQUEsd0JBQUEsV0FBQSxDQUFBLElBQUEsQ0FBQSxvQkFBQSxDQUFBLElBQUEsTUFBQSxDQUFBLFNBQUEsQ0FBQSxjQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsRUFBQSxDQUFBLFNBQUEsQ0FBQSxHQUFBLENBQUEsR0FBQSxNQUFBLENBQUEsd0JBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxVQUFBLENBQUEsS0FBQSxDQUFBLENBQUEsR0FBQSxJQUFBLENBQUEsQ0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLGNBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxDQUFBLFlBQUEsQ0FBQSxDQUFBLE9BQUEsR0FBQSxDQUFBLEVBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQSxFQUFBLENBQUEsR0FBQSxDQUFBO0FBSEEsSUFBQSxLQUFBLEVBQUEsSUFBQTtBQVFBLElBQUEsR0FBTyxJQUFBLGdCQUFBLEVBQ0w7RUFBQSxJQUFBLEVBQU0sWUFBTjtFQUNBLE9BQUEsRUFBUyxTQUFBLENBQUEsR0FBRSxJQUFGLEVBQUE7SUFDUCxNQUFNLElBQUksS0FBSixDQUFVLGtDQUFrQyxJQUFJLENBQUMsU0FBTCxDQUFlLElBQWpELENBQUEsRUFBVixDQUFBO0VBREM7QUFEVCxDQURLLENBQUE7QUFLUCxJQUFBLGdCQUFBLEVBQVEsSUFBUixFQUFjLFlBQUssQ0FBQyxNQUFwQixFQUE0QixZQUFLLENBQUMsTUFBbEMsRUFBMEMsSUFBSSxDQUFDLFVBQS9DLEVBQTRELFVBQUUsS0FBRixFQUFTLEtBQVQsRUFBZ0IsSUFBaEIsRUFBQTtTQUMxRCxJQUFJLEtBQUosQ0FBVTtJQUFFLEtBQUY7SUFBUyxLQUFUO0lBQWdCO0VBQWhCLENBQVYsQ0FBQTtBQUQwRCxDQUE1RCxDQUFBO0FBSU0sT0FBQSxDQUFBLEtBQUEsR0FBQSxLQUFBLEdBQUEsWUFBQTtFQUFOLE1BQUEsS0FBQSxDQUFBO0lBQ0UsV0FBYSxDQUFDO01BQUcsS0FBQSxFQUFBLE1BQUg7TUFBVyxLQUFBLEVBQUEsTUFBWDtNQUFtQixJQUFBLEVBQUE7SUFBbkIsQ0FBRCxFQUFBO01BQUcsSUFBQyxDQUFBLEtBQUEsR0FBQSxNQUFBO01BQU8sSUFBQyxDQUFBLEtBQUEsR0FBQSxNQUFBO01BQU8sSUFBQyxDQUFBLElBQUEsR0FBQSxLQUFBO0lBQXBCO0lBV2IsTUFBUSxDQUFBLEdBQUUsVUFBRixFQUFBO2FBQ04sSUFBQyxDQUFBLElBQUQsQ0FBTSxJQUFDLENBQUEsS0FBUCxFQUFjLElBQUMsQ0FBQSxLQUFmLEVBQXNCLEdBQUEsVUFBdEIsQ0FBQTtJQURNO0VBWlY7RUFBQTtFQUdFLElBQUksQ0FBQyxLQUFMLENBQVcsS0FBQyxDQUFBLFNBQVosRUFBZ0IsQ0FDZCxJQUFJLENBQUMsT0FBTCxDQUNFO0lBQUEsS0FBQSxFQUFPLFNBQUEsQ0FBQSxFQUFBO2FBQUcsSUFBQyxDQUFBLEtBQUssQ0FBQyxLQUFBO0lBQVYsQ0FBUDtJQUNBLE1BQUEsRUFBUSxTQUFBLENBQUEsRUFBQTthQUFHLElBQUksQ0FBQyxpQkFBTCxDQUF1QixJQUFDLENBQUEsSUFBeEIsQ0FBQTtJQUFIO0VBRFIsQ0FERixDQURjLENBQWhCLENBQUE7RUFNQSxLQUFDLENBQUEsSUFBRCxHQUFPLElBQUE7RUFDUCxLQUFDLENBQUEsTUFBRCxHQUFTLElBQUksQ0FBQyxNQUFMLENBQVksS0FBWixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgTWV0YSBmcm9tIFwiQGRhc2hraXRlL2pveS9tZXRhY2xhc3NcIlxuaW1wb3J0ICogYXMgVHlwZSBmcm9tIFwiQGRhc2hraXRlL2pveS90eXBlXCJcbmltcG9ydCAqIGFzIFZhbHVlIGZyb20gXCJAZGFzaGtpdGUvam95L3ZhbHVlXCJcbmltcG9ydCB7IGdlbmVyaWMgfSBmcm9tIFwiQGRhc2hraXRlL2pveS9nZW5lcmljXCJcbmltcG9ydCB7IEdyYXBoIH0gZnJvbSBcIi4vZ3JhcGhcIlxuaW1wb3J0IHsgVGFsb3MgfSBmcm9tIFwiLi90YWxvc1wiXG5cblxubWFrZSA9IGdlbmVyaWMgXG4gIG5hbWU6IFwiZHJpdmUgbWFrZVwiXG4gIGRlZmF1bHQ6ICggYXJncy4uLiApIC0+IFxuICAgIHRocm93IG5ldyBFcnJvciBcIkRyaXZlLm1ha2U6IGlucHV0IGlzIG1hbGZvcm1lZCAje0pTT04uc3RyaW5naWZ5IGFyZ3N9XCJcblxuZ2VuZXJpYyBtYWtlLCBHcmFwaC5pc1R5cGUsIFRhbG9zLmlzVHlwZSwgVHlwZS5pc0Z1bmN0aW9uLCAgKCBncmFwaCwgdGFsb3MsIHN0ZXAgKSAtPlxuICBuZXcgRHJpdmUgeyBncmFwaCwgdGFsb3MsIHN0ZXAgfVxuXG5cbmNsYXNzIERyaXZlXG4gIGNvbnN0cnVjdG9yOiAoeyBAZ3JhcGgsIEB0YWxvcywgQHN0ZXAgfSkgLT5cblxuICBNZXRhLm1peGluIEA6OiwgW1xuICAgIE1ldGEuZ2V0dGVyc1xuICAgICAgc3RhdGU6IC0+IEB0YWxvcy5zdGF0ZVxuICAgICAgaXNTeW5jOiAtPiBUeXBlLmlzUmVndWxhckZ1bmN0aW9uIEBzdGVwXG4gIF1cblxuICBAbWFrZTogbWFrZVxuICBAaXNUeXBlOiBUeXBlLmlzVHlwZSBAXG5cbiAgdXBkYXRlOiAoIHRyYW5zZm9ybXMuLi4gKSAtPlxuICAgIEBzdGVwIEBncmFwaCwgQHRhbG9zLCB0cmFuc2Zvcm1zLi4uXG5cblxuZXhwb3J0IHtcbiAgRHJpdmVcbn0iXSwic291cmNlUm9vdCI6IiJ9
//# sourceURL=src/containers/drive.coffee