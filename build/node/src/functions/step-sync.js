"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.stepSync = exports.debugSync = void 0;
var Type = _interopRequireWildcard(require("@dashkite/joy/type"));
var _predicate = require("@dashkite/joy/predicate");
var _generic = require("@dashkite/joy/generic");
var _index = require("../containers/index.js");
var Errors = _interopRequireWildcard(require("../containers/errors.js"));
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
var _debug, _step, debug, matchEdge, matchVertex, move, run, step;
matchVertex = function (graph, talos) {
  var vertex;
  vertex = graph.get(talos);
  if (vertex == null) {
    talos.throw(Errors.InvalidState.create(`talos state ${talos.state} is not in graph`));
  }
  return vertex;
};
matchEdge = function (vertex, talos, transform) {
  var edge, i, len, ref;
  ref = vertex.edges;
  for (i = 0, len = ref.length; i < len; i++) {
    edge = ref[i];
    if (edge.accept(transform, talos) === true) {
      return edge;
    }
  }
  return talos.throw(Errors.MissingTransition.create(`no edge matches transform ${transform}`));
};
run = function (talos, edge) {
  var error;
  if (edge.run != null) {
    try {
      return edge.run(talos);
    } catch (error1) {
      error = error1;
      return talos.throw(Errors.FailedRun.create(error, "encountered an error while running edge function"));
    }
  }
};
move = function (talos, edge) {
  var error;
  try {
    return edge.move(talos);
  } catch (error1) {
    error = error1;
    return talos.throw(Errors.FailedMove.create(error, "encountered an error while moving states"));
  }
};
exports.stepSync = step = (0, _generic.generic)({
  name: "step talos",
  default: function (...args) {
    throw new Error(`step: input is malformed ${JSON.stringify(args)}`);
  }
});
(0, _generic.generic)(step, _index.Graph.isType, _index.Talos.isType, Type.isAny, function (graph, talos, transform) {
  return _step(graph, talos, transform);
});
(0, _generic.generic)(step, _index.Graph.isType, (0, _predicate.negate)(_index.Talos.isType), function (graph, transform) {
  return step(graph, _index.Talos.create(), transform);
});
_step = function (graph, talos, transform) {
  var edge, vertex;
  vertex = matchVertex(graph, talos);
  if (talos.halted) {
    return talos;
  }
  edge = matchEdge(vertex, talos, transform);
  if (talos.halted) {
    return talos;
  }
  run(talos, edge);
  if (talos.halted) {
    return talos;
  }
  move(talos, edge);
  return talos;
};
exports.debugSync = debug = (0, _generic.generic)({
  name: "debug step talos",
  default: function (...args) {
    throw new Error(`debug step: input is malformed ${JSON.stringify(args)}`);
  }
});
(0, _generic.generic)(debug, _index.Graph.isType, _index.Talos.isType, Type.isAny, function (graph, talos, transform) {
  return _debug(graph, talos, transform);
});
(0, _generic.generic)(debug, _index.Graph.isType, (0, _predicate.negate)(_index.Talos.isType), function (graph, transform) {
  return _debug(graph, _index.Talos.create(), transform);
});
_debug = function (graph, talos, transform) {
  var edge, vertex;
  console.log("starting step", {
    graph,
    talos,
    transform
  });
  vertex = matchVertex(graph, talos);
  if (talos.halted) {
    console.error("encountered error matching vertex", talos.error, talos);
    return talos;
  } else {
    console.log("vertex matched", {
      vertex,
      talos
    });
  }
  edge = matchEdge(vertex, talos, transform);
  if (talos.halted) {
    console.error("encountered error matching edge", talos.error, talos);
    return talos;
  } else {
    console.log("edge matched", {
      edge,
      talos
    });
  }
  run(talos, edge);
  if (talos.halted) {
    console.error("encountered error running edge function", talos.error, talos);
    return talos;
  } else {
    console.log("edge function complete", {
      talos
    });
  }
  move(talos, edge);
  if (talos.halted) {
    console.error("encountered error running move function", talos.error, talos);
    return talos;
  } else {
    console.log("talos move complete", {
      talos
    });
  }
  return talos;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9mdW5jdGlvbnMvc3RlcC1zeW5jLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBLElBQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFDQSxJQUFBLFVBQUEsR0FBQSxPQUFBO0FBQ0EsSUFBQSxRQUFBLEdBQUEsT0FBQTtBQUFBLElBQUEsTUFBQSxHQUFBLE9BQUE7QUFBQSxJQUFBLE1BQUEsR0FBQSx1QkFBQSxDQUFBLE9BQUE7QUFBQSxTQUFBLHlCQUFBLENBQUEsNkJBQUEsT0FBQSxtQkFBQSxDQUFBLE9BQUEsT0FBQSxJQUFBLENBQUEsT0FBQSxPQUFBLFlBQUEsd0JBQUEsWUFBQSxDQUFBLENBQUEsV0FBQSxDQUFBLEdBQUEsQ0FBQSxHQUFBLENBQUEsS0FBQSxDQUFBO0FBQUEsU0FBQSx3QkFBQSxDQUFBLEVBQUEsQ0FBQSxTQUFBLENBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLFVBQUEsU0FBQSxDQUFBLGVBQUEsQ0FBQSx1QkFBQSxDQUFBLHlCQUFBLENBQUEsV0FBQSxPQUFBLEVBQUEsQ0FBQSxRQUFBLENBQUEsR0FBQSx3QkFBQSxDQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBLFVBQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBLE9BQUEsQ0FBQSxLQUFBLFNBQUEsVUFBQSxDQUFBLEdBQUEsTUFBQSxDQUFBLGNBQUEsSUFBQSxNQUFBLENBQUEsd0JBQUEsV0FBQSxDQUFBLElBQUEsQ0FBQSxvQkFBQSxDQUFBLElBQUEsTUFBQSxDQUFBLFNBQUEsQ0FBQSxjQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsRUFBQSxDQUFBLFNBQUEsQ0FBQSxHQUFBLENBQUEsR0FBQSxNQUFBLENBQUEsd0JBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxVQUFBLENBQUEsS0FBQSxDQUFBLENBQUEsR0FBQSxJQUFBLENBQUEsQ0FBQSxHQUFBLElBQUEsTUFBQSxDQUFBLGNBQUEs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QWMsaUNBQWQsRUFBaUQsS0FBSyxDQUFDLEtBQXZELEVBQThELEtBQTlELENBQUE7SUFDQSxPQUFPLEtBRlQ7R0FBQSxNQUFBO0lBSUUsT0FBTyxDQUFDLEdBQVIsQ0FBWSxjQUFaLEVBQTRCO01BQUUsSUFBRjtNQUFRO0lBQVIsQ0FBNUIsQ0FKRjs7RUFNQSxHQUFBLENBQUksS0FBSixFQUFXLElBQVgsQ0FBQTtFQUNBLElBQUcsS0FBSyxDQUFDLE1BQVQsRUFBQTtJQUNFLE9BQU8sQ0FBQyxLQUFSLENBQWMseUNBQWQsRUFBeUQsS0FBSyxDQUFDLEtBQS9ELEVBQXNFLEtBQXRFLENBQUE7SUFDQSxPQUFPLEtBRlQ7R0FBQSxNQUFBO0lBSUUsT0FBTyxDQUFDLEdBQVIsQ0FBWSx3QkFBWixFQUFzQztNQUFFO0lBQUYsQ0FBdEMsQ0FKRjs7RUFNQSxJQUFBLENBQUssS0FBTCxFQUFZLElBQVosQ0FBQTtFQUNBLElBQUcsS0FBSyxDQUFDLE1BQVQsRUFBQTtJQUNFLE9BQU8sQ0FBQyxLQUFSLENBQWMseUNBQWQsRUFBeUQsS0FBSyxDQUFDLEtBQS9ELEVBQXNFLEtBQXRFLENBQUE7SUFDQSxPQUFPLEtBRlQ7R0FBQSxNQUFBO0lBSUUsT0FBTyxDQUFDLEdBQVIsQ0FBWSxxQkFBWixFQUFtQztNQUFFO0lBQUYsQ0FBbkMsQ0FKRjs7U0FNQSxLQUFBO0FBL0JPLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBUeXBlIGZyb20gXCJAZGFzaGtpdGUvam95L3R5cGVcIlxuaW1wb3J0IHsgbmVnYXRlIH0gZnJvbSBcIkBkYXNoa2l0ZS9qb3kvcHJlZGljYXRlXCJcbmltcG9ydCB7IGdlbmVyaWMgfSBmcm9tIFwiQGRhc2hraXRlL2pveS9nZW5lcmljXCJcbmltcG9ydCB7IEdyYXBoLCBUYWxvcyB9IGZyb20gXCIuLi9jb250YWluZXJzXCJcbmltcG9ydCAqIGFzIEVycm9ycyBmcm9tIFwiLi4vY29udGFpbmVycy9lcnJvcnNcIlxuXG5cbm1hdGNoVmVydGV4ID0gKCBncmFwaCwgdGFsb3MgKSAtPlxuICB2ZXJ0ZXggPSBncmFwaC5nZXQgdGFsb3NcbiAgaWYgIXZlcnRleD9cbiAgICB0YWxvcy50aHJvdyBFcnJvcnMuSW52YWxpZFN0YXRlLmNyZWF0ZSBcInRhbG9zIHN0YXRlICN7IHRhbG9zLnN0YXRlIH0gaXNcbiAgICAgIG5vdCBpbiBncmFwaFwiXG4gIHZlcnRleFxuXG5tYXRjaEVkZ2UgPSAoIHZlcnRleCwgdGFsb3MsIHRyYW5zZm9ybSApIC0+XG4gIGZvciBlZGdlIGluIHZlcnRleC5lZGdlc1xuICAgIGlmICggZWRnZS5hY2NlcHQgdHJhbnNmb3JtLCB0YWxvcyApID09IHRydWVcbiAgICAgIHJldHVybiBlZGdlXG4gIHRhbG9zLnRocm93IEVycm9ycy5NaXNzaW5nVHJhbnNpdGlvbi5jcmVhdGUgXCJubyBlZGdlIG1hdGNoZXMgdHJhbnNmb3JtIFxuICAgICN7IHRyYW5zZm9ybSB9XCJcblxucnVuID0gKCB0YWxvcywgZWRnZSApIC0+XG4gIGlmIGVkZ2UucnVuP1xuICAgIHRyeVxuICAgICAgZWRnZS5ydW4gdGFsb3NcbiAgICBjYXRjaCBlcnJvclxuICAgICAgdGFsb3MudGhyb3cgRXJyb3JzLkZhaWxlZFJ1bi5jcmVhdGUgZXJyb3IsIFxuICAgICAgICBcImVuY291bnRlcmVkIGFuIGVycm9yIHdoaWxlIHJ1bm5pbmcgZWRnZSBmdW5jdGlvblwiXG5cbm1vdmUgPSAoIHRhbG9zLCBlZGdlICkgLT5cbiAgdHJ5XG4gICAgZWRnZS5tb3ZlIHRhbG9zXG4gIGNhdGNoIGVycm9yXG4gICAgdGFsb3MudGhyb3cgRXJyb3JzLkZhaWxlZE1vdmUuY3JlYXRlIGVycm9yLCBcbiAgICAgIFwiZW5jb3VudGVyZWQgYW4gZXJyb3Igd2hpbGUgbW92aW5nIHN0YXRlc1wiXG5cblxuc3RlcCA9IGdlbmVyaWMgXG4gIG5hbWU6IFwic3RlcCB0YWxvc1wiXG4gIGRlZmF1bHQ6ICggYXJncy4uLiApIC0+IFxuICAgIHRocm93IG5ldyBFcnJvciBcInN0ZXA6IGlucHV0IGlzIG1hbGZvcm1lZCAje0pTT04uc3RyaW5naWZ5IGFyZ3N9XCJcblxuZ2VuZXJpYyBzdGVwLCBHcmFwaC5pc1R5cGUsIFRhbG9zLmlzVHlwZSwgVHlwZS5pc0FueSwgKCBncmFwaCwgdGFsb3MsIHRyYW5zZm9ybSApIC0+XG4gIF9zdGVwIGdyYXBoLCB0YWxvcywgdHJhbnNmb3JtXG5cbmdlbmVyaWMgc3RlcCwgR3JhcGguaXNUeXBlLCAoIG5lZ2F0ZSBUYWxvcy5pc1R5cGUgKSwgKCBncmFwaCwgdHJhbnNmb3JtICkgLT5cbiAgc3RlcCBncmFwaCwgVGFsb3MuY3JlYXRlKCksIHRyYW5zZm9ybVxuXG5cbl9zdGVwID0gKCBncmFwaCwgdGFsb3MsIHRyYW5zZm9ybSApIC0+XG4gIHZlcnRleCA9IG1hdGNoVmVydGV4IGdyYXBoLCB0YWxvc1xuICByZXR1cm4gdGFsb3MgaWYgdGFsb3MuaGFsdGVkXG5cbiAgZWRnZSA9IG1hdGNoRWRnZSB2ZXJ0ZXgsIHRhbG9zLCB0cmFuc2Zvcm1cbiAgcmV0dXJuIHRhbG9zIGlmIHRhbG9zLmhhbHRlZFxuXG4gIHJ1biB0YWxvcywgZWRnZVxuICByZXR1cm4gdGFsb3MgaWYgdGFsb3MuaGFsdGVkXG5cbiAgbW92ZSB0YWxvcywgZWRnZVxuICB0YWxvc1xuXG5cbmRlYnVnID0gZ2VuZXJpYyBcbiAgbmFtZTogXCJkZWJ1ZyBzdGVwIHRhbG9zXCJcbiAgZGVmYXVsdDogKCBhcmdzLi4uICkgLT4gXG4gICAgdGhyb3cgbmV3IEVycm9yIFwiZGVidWcgc3RlcDogaW5wdXQgaXMgbWFsZm9ybWVkICN7SlNPTi5zdHJpbmdpZnkgYXJnc31cIlxuXG5nZW5lcmljIGRlYnVnLCBHcmFwaC5pc1R5cGUsIFRhbG9zLmlzVHlwZSwgVHlwZS5pc0FueSwgKCBncmFwaCwgdGFsb3MsIHRyYW5zZm9ybSApIC0+XG4gIF9kZWJ1ZyBncmFwaCwgdGFsb3MsIHRyYW5zZm9ybVxuXG5nZW5lcmljIGRlYnVnLCBHcmFwaC5pc1R5cGUsICggbmVnYXRlIFRhbG9zLmlzVHlwZSApLCAoIGdyYXBoLCB0cmFuc2Zvcm0gKSAtPlxuICBfZGVidWcgZ3JhcGgsIFRhbG9zLmNyZWF0ZSgpLCB0cmFuc2Zvcm1cblxuXG5fZGVidWcgPSAoIGdyYXBoLCB0YWxvcywgdHJhbnNmb3JtICkgLT5cbiAgY29uc29sZS5sb2cgXCJzdGFydGluZyBzdGVwXCIsIHsgZ3JhcGgsIHRhbG9zLCB0cmFuc2Zvcm0gfVxuXG4gIHZlcnRleCA9IG1hdGNoVmVydGV4IGdyYXBoLCB0YWxvc1xuICBpZiB0YWxvcy5oYWx0ZWRcbiAgICBjb25zb2xlLmVycm9yIFwiZW5jb3VudGVyZWQgZXJyb3IgbWF0Y2hpbmcgdmVydGV4XCIsIHRhbG9zLmVycm9yLCB0YWxvc1xuICAgIHJldHVybiB0YWxvc1xuICBlbHNlXG4gICAgY29uc29sZS5sb2cgXCJ2ZXJ0ZXggbWF0Y2hlZFwiLCB7IHZlcnRleCwgdGFsb3MgfVxuICBcbiAgZWRnZSA9IG1hdGNoRWRnZSB2ZXJ0ZXgsIHRhbG9zLCB0cmFuc2Zvcm1cbiAgaWYgdGFsb3MuaGFsdGVkXG4gICAgY29uc29sZS5lcnJvciBcImVuY291bnRlcmVkIGVycm9yIG1hdGNoaW5nIGVkZ2VcIiwgdGFsb3MuZXJyb3IsIHRhbG9zXG4gICAgcmV0dXJuIHRhbG9zXG4gIGVsc2VcbiAgICBjb25zb2xlLmxvZyBcImVkZ2UgbWF0Y2hlZFwiLCB7IGVkZ2UsIHRhbG9zIH1cblxuICBydW4gdGFsb3MsIGVkZ2VcbiAgaWYgdGFsb3MuaGFsdGVkXG4gICAgY29uc29sZS5lcnJvciBcImVuY291bnRlcmVkIGVycm9yIHJ1bm5pbmcgZWRnZSBmdW5jdGlvblwiLCB0YWxvcy5lcnJvciwgdGFsb3NcbiAgICByZXR1cm4gdGFsb3NcbiAgZWxzZVxuICAgIGNvbnNvbGUubG9nIFwiZWRnZSBmdW5jdGlvbiBjb21wbGV0ZVwiLCB7IHRhbG9zIH1cblxuICBtb3ZlIHRhbG9zLCBlZGdlXG4gIGlmIHRhbG9zLmhhbHRlZFxuICAgIGNvbnNvbGUuZXJyb3IgXCJlbmNvdW50ZXJlZCBlcnJvciBydW5uaW5nIG1vdmUgZnVuY3Rpb25cIiwgdGFsb3MuZXJyb3IsIHRhbG9zXG4gICAgcmV0dXJuIHRhbG9zXG4gIGVsc2VcbiAgICBjb25zb2xlLmxvZyBcInRhbG9zIG1vdmUgY29tcGxldGVcIiwgeyB0YWxvcyB9XG5cbiAgdGFsb3NcblxuXG5leHBvcnQge1xuICBzdGVwIGFzIHN0ZXBTeW5jXG4gIGRlYnVnIGFzIGRlYnVnU3luY1xufSJdLCJzb3VyY2VSb290IjoiIn0=
//# sourceURL=src/functions/step-sync.coffee