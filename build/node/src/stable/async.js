"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.step = exports.debug = void 0;
var Type = _interopRequireWildcard(require("@dashkite/joy/type"));
var _predicate = require("@dashkite/joy/predicate");
var _generic = require("@dashkite/joy/generic");
var _index = require("../containers/index.js");
var Errors = _interopRequireWildcard(require("../containers/errors.js"));
function _getRequireWildcardCache(e) { if ("function" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function (e) { return e ? t : r; })(e); }
function _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || "object" != typeof e && "function" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if ("default" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }
var _debug, _step, debug, matchEdge, matchVertex, move, run, step;
matchVertex = function (graph, talos) {
  var vertex;
  vertex = graph.get(talos);
  if (vertex == null) {
    talos.throw(Errors.InvalidState.create("talos state is not in graph"));
  }
  return vertex;
};
matchEdge = async function (vertex, talos, transform) {
  var edge, i, len, ref;
  ref = vertex.edges;
  for (i = 0, len = ref.length; i < len; i++) {
    edge = ref[i];
    if ((await edge.accept(talos, transform)) === true) {
      return edge;
    }
  }
};
run = async function (edge, talos, transform) {
  var error;
  if (edge.run != null) {
    try {
      return await edge.run(talos, transform);
    } catch (error1) {
      error = error1;
      return talos.throw(Errors.FailedRun.create(error, "encountered an error while running edge function"));
    }
  }
};
move = async function (edge, talos, transform) {
  var error;
  try {
    return await edge.move(talos, transform);
  } catch (error1) {
    error = error1;
    return talos.throw(Errors.FailedMove.create(error, "encountered an error while moving states"));
  }
};
exports.step = step = (0, _generic.generic)({
  name: "step talos",
  default: function (...args) {
    throw new Error(`step: input is malformed ${JSON.stringify(args)}`);
  }
});
(0, _generic.generic)(step, _index.Graph.isType, _index.Talos.isType, Type.isAny, function (graph, talos, transform) {
  return _step(graph, talos, transform);
});
(0, _generic.generic)(step, _index.Graph.isType, (0, _predicate.negate)(_index.Talos.isType), function (graph, transform) {
  return step(graph, _index.Talos.create(), transform);
});
_step = async function (graph, talos, transform) {
  var edge, vertex;
  vertex = matchVertex(graph, talos);
  if (talos.halted) {
    return talos;
  }
  edge = await matchEdge(vertex, talos, transform);
  if (edge == null) {
    return talos;
  }
  if (talos.halted) {
    return talos;
  }
  await run(edge, talos, transform);
  if (talos.halted) {
    return talos;
  }
  await move(edge, talos, transform);
  return talos;
};
exports.debug = debug = (0, _generic.generic)({
  name: "debug step talos",
  default: function (...args) {
    throw new Error(`debug step: input is malformed ${JSON.stringify(args)}`);
  }
});
(0, _generic.generic)(debug, _index.Graph.isType, _index.Talos.isType, Type.isAny, function (graph, talos, transform) {
  return _debug(graph, talos, transform);
});
(0, _generic.generic)(debug, _index.Graph.isType, (0, _predicate.negate)(_index.Talos.isType), function (graph, transform) {
  return _debug(graph, _index.Talos.create(), transform);
});
_debug = async function (graph, talos, transform) {
  var edge, vertex;
  console.log("starting step", {
    graph,
    talos,
    transform
  });
  vertex = matchVertex(graph, talos);
  if (talos.halted) {
    console.error("encountered error matching vertex", talos.error.error, talos);
    return talos;
  } else {
    console.log("vertex matched", {
      vertex,
      talos
    });
  }
  edge = await matchEdge(vertex, talos, transform);
  if (edge == null) {
    console.log("no edge match, ignoring transform");
    return talos;
  }
  if (talos.halted) {
    console.error("encountered error matching edge", talos.error.error, talos);
    return talos;
  } else {
    console.log("edge matched", {
      edge,
      talos
    });
  }
  await run(edge, talos, transform);
  if (talos.halted) {
    console.error("encountered error running edge function", talos.error.error, talos);
    return talos;
  } else {
    console.log("edge function complete", {
      talos
    });
  }
  await move(edge, talos, transform);
  if (talos.halted) {
    console.error("encountered error running move function", talos.error.error, talos);
    return talos;
  } else {
    console.log("talos move complete", {
      talos
    });
  }
  return talos;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9zdGFibGUvYXN5bmMuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUEsSUFBQSxHQUFBLHVCQUFBLENBQUEsT0FBQTtBQUNBLElBQUEsVUFBQSxHQUFBLE9BQUE7QUFDQSxJQUFBLFFBQUEsR0FBQSxPQUFBO0FBQUEsSUFBQSxNQUFBLEdBQUEsT0FBQTtBQUFBLElBQUEsTUFBQSxHQUFBLHVCQUFBLENBQUEsT0FBQTtBQUFBLFNBQUEseUJBQUEsQ0FBQSw2QkFBQSxPQUFBLG1CQUFBLENBQUEsT0FBQSxPQUFBLElBQUEsQ0FBQSxPQUFBLE9BQUEsWUFBQSx3QkFBQSxZQUFBLENBQUEsQ0FBQSxXQUFBLENBQUEsR0FBQSxDQUFBLEdBQUEsQ0FBQSxLQUFBLENBQUE7QUFBQSxTQUFBLHdCQUFBLENBQUEsRUFBQSxDQUFBLFNBQUEsQ0FBQSxJQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsVUFBQSxTQUFBLENBQUEsZUFBQSxDQUFBLHVCQUFBLENBQUEseUJBQUEsQ0FBQSxXQUFBLE9BQUEsRUFBQSxDQUFBLFFBQUEsQ0FBQSxHQUFBLHdCQUFBLENBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsR0FBQSxDQUFBLENBQUEsVUFBQSxDQUFBLENBQUEsR0FBQSxDQUFBLENBQUEsT0FBQSxDQUFBLEtBQUEsU0FBQSxVQUFBLENBQUEsR0FBQSxNQUFBLENBQUEsY0FBQSxJQUFBLE1BQUEsQ0FBQSx3QkFBQSxXQUFBLENBQUEsSUFBQSxDQUFBLG9CQUFBLENBQUEsSUFBQSxNQUFBLENBQUEsU0FBQSxDQUFBLGNBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxFQUFBLENBQUEsU0FBQSxDQUFBLEdBQUEsQ0FBQSxHQUFBLE1BQUEsQ0FBQSx3QkFBQSxDQUFBLENBQUEsRUFBQSxDQUFBLFVBQUEsQ0FBQSxLQUFBLENBQUEsQ0FBQSxHQUFBLElBQUEsQ0FBQSxDQUFBLEdBQUEsSUFBQSxNQUFBLENBQUEsY0FBQSxDQUFBLENB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QUEvQixDQUFBO0VBQ1AsSUFBSSxJQUFBLElBQUEsSUFBSixFQUFBO0lBQ0UsT0FBTyxDQUFDLEdBQVIsQ0FBWSxtQ0FBWixDQUFBO0lBQ0EsT0FBTyxLQUZUOztFQUdBLElBQUcsS0FBSyxDQUFDLE1BQVQsRUFBQTtJQUNFLE9BQU8sQ0FBQyxLQUFSLENBQWMsaUNBQWQsRUFBaUQsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUE3RCxFQUFvRSxLQUFwRSxDQUFBO0lBQ0EsT0FBTyxLQUZUO0dBQUEsTUFBQTtJQUlFLE9BQU8sQ0FBQyxHQUFSLENBQVksY0FBWixFQUE0QjtNQUFFLElBQUY7TUFBUTtJQUFSLENBQTVCLENBSkY7O0VBTUEsTUFBTSxHQUFBLENBQUksSUFBSixFQUFVLEtBQVYsRUFBaUIsU0FBakIsQ0FBQTtFQUNOLElBQUcsS0FBSyxDQUFDLE1BQVQsRUFBQTtJQUNFLE9BQU8sQ0FBQyxLQUFSLENBQWMseUNBQWQsRUFBeUQsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFyRSxFQUE0RSxLQUE1RSxDQUFBO0lBQ0EsT0FBTyxLQUZUO0dBQUEsTUFBQTtJQUlFLE9BQU8sQ0FBQyxHQUFSLENBQVksd0JBQVosRUFBc0M7TUFBRTtJQUFGLENBQXRDLENBSkY7O0VBTUEsTUFBTSxJQUFBLENBQUssSUFBTCxFQUFXLEtBQVgsRUFBa0IsU0FBbEIsQ0FBQTtFQUNOLElBQUcsS0FBSyxDQUFDLE1BQVQsRUFBQTtJQUNFLE9BQU8sQ0FBQyxLQUFSLENBQWMseUNBQWQsRUFBeUQsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFyRSxFQUE0RSxLQUE1RSxDQUFBO0lBQ0EsT0FBTyxLQUZUO0dBQUEsTUFBQTtJQUlFLE9BQU8sQ0FBQyxHQUFSLENBQVkscUJBQVosRUFBbUM7TUFBRTtJQUFGLENBQW5DLENBSkY7O1NBTUEsS0FBQTtBQWxDTyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgVHlwZSBmcm9tIFwiQGRhc2hraXRlL2pveS90eXBlXCJcbmltcG9ydCB7IG5lZ2F0ZSB9IGZyb20gXCJAZGFzaGtpdGUvam95L3ByZWRpY2F0ZVwiXG5pbXBvcnQgeyBnZW5lcmljIH0gZnJvbSBcIkBkYXNoa2l0ZS9qb3kvZ2VuZXJpY1wiXG5pbXBvcnQgeyBHcmFwaCwgVGFsb3MgfSBmcm9tIFwiLi4vY29udGFpbmVyc1wiXG5pbXBvcnQgKiBhcyBFcnJvcnMgZnJvbSBcIi4uL2NvbnRhaW5lcnMvZXJyb3JzXCJcblxuXG5tYXRjaFZlcnRleCA9ICggZ3JhcGgsIHRhbG9zICkgLT5cbiAgdmVydGV4ID0gZ3JhcGguZ2V0IHRhbG9zXG4gIGlmICF2ZXJ0ZXg/XG4gICAgdGFsb3MudGhyb3cgRXJyb3JzLkludmFsaWRTdGF0ZS5jcmVhdGUgXCJ0YWxvcyBzdGF0ZSBpcyBub3RcbiAgICAgIGluIGdyYXBoXCJcbiAgdmVydGV4XG5cbm1hdGNoRWRnZSA9ICggdmVydGV4LCB0YWxvcywgdHJhbnNmb3JtICkgLT5cbiAgZm9yIGVkZ2UgaW4gdmVydGV4LmVkZ2VzXG4gICAgaWYgKCBhd2FpdCBlZGdlLmFjY2VwdCB0YWxvcywgdHJhbnNmb3JtICkgPT0gdHJ1ZVxuICAgICAgcmV0dXJuIGVkZ2VcbiAgcmV0dXJuXG5cbnJ1biA9ICggZWRnZSwgdGFsb3MsIHRyYW5zZm9ybSApIC0+XG4gIGlmIGVkZ2UucnVuP1xuICAgIHRyeVxuICAgICAgYXdhaXQgZWRnZS5ydW4gdGFsb3MsIHRyYW5zZm9ybVxuICAgIGNhdGNoIGVycm9yXG4gICAgICB0YWxvcy50aHJvdyBFcnJvcnMuRmFpbGVkUnVuLmNyZWF0ZSBlcnJvciwgXG4gICAgICAgIFwiZW5jb3VudGVyZWQgYW4gZXJyb3Igd2hpbGUgcnVubmluZyBlZGdlIGZ1bmN0aW9uXCJcblxubW92ZSA9ICggZWRnZSwgdGFsb3MsIHRyYW5zZm9ybSApIC0+XG4gIHRyeVxuICAgIGF3YWl0IGVkZ2UubW92ZSB0YWxvcywgdHJhbnNmb3JtXG4gIGNhdGNoIGVycm9yXG4gICAgdGFsb3MudGhyb3cgRXJyb3JzLkZhaWxlZE1vdmUuY3JlYXRlIGVycm9yLCBcbiAgICAgIFwiZW5jb3VudGVyZWQgYW4gZXJyb3Igd2hpbGUgbW92aW5nIHN0YXRlc1wiXG5cblxuc3RlcCA9IGdlbmVyaWMgXG4gIG5hbWU6IFwic3RlcCB0YWxvc1wiXG4gIGRlZmF1bHQ6ICggYXJncy4uLiApIC0+IFxuICAgIHRocm93IG5ldyBFcnJvciBcInN0ZXA6IGlucHV0IGlzIG1hbGZvcm1lZCAje0pTT04uc3RyaW5naWZ5IGFyZ3N9XCJcblxuZ2VuZXJpYyBzdGVwLCBHcmFwaC5pc1R5cGUsIFRhbG9zLmlzVHlwZSwgVHlwZS5pc0FueSwgKCBncmFwaCwgdGFsb3MsIHRyYW5zZm9ybSApIC0+XG4gIF9zdGVwIGdyYXBoLCB0YWxvcywgdHJhbnNmb3JtXG5cbmdlbmVyaWMgc3RlcCwgR3JhcGguaXNUeXBlLCAoIG5lZ2F0ZSBUYWxvcy5pc1R5cGUgKSwgKCBncmFwaCwgdHJhbnNmb3JtICkgLT5cbiAgc3RlcCBncmFwaCwgVGFsb3MuY3JlYXRlKCksIHRyYW5zZm9ybVxuXG5cbl9zdGVwID0gKCBncmFwaCwgdGFsb3MsIHRyYW5zZm9ybSApIC0+XG4gIHZlcnRleCA9IG1hdGNoVmVydGV4IGdyYXBoLCB0YWxvc1xuICByZXR1cm4gdGFsb3MgaWYgdGFsb3MuaGFsdGVkXG5cbiAgZWRnZSA9IGF3YWl0IG1hdGNoRWRnZSB2ZXJ0ZXgsIHRhbG9zLCB0cmFuc2Zvcm1cbiAgcmV0dXJuIHRhbG9zIGlmICFlZGdlP1xuICByZXR1cm4gdGFsb3MgaWYgdGFsb3MuaGFsdGVkXG5cbiAgYXdhaXQgcnVuIGVkZ2UsIHRhbG9zLCB0cmFuc2Zvcm1cbiAgcmV0dXJuIHRhbG9zIGlmIHRhbG9zLmhhbHRlZFxuXG4gIGF3YWl0IG1vdmUgZWRnZSwgdGFsb3MsIHRyYW5zZm9ybVxuICB0YWxvc1xuXG5cblxuZGVidWcgPSBnZW5lcmljIFxuICBuYW1lOiBcImRlYnVnIHN0ZXAgdGFsb3NcIlxuICBkZWZhdWx0OiAoIGFyZ3MuLi4gKSAtPiBcbiAgICB0aHJvdyBuZXcgRXJyb3IgXCJkZWJ1ZyBzdGVwOiBpbnB1dCBpcyBtYWxmb3JtZWQgI3tKU09OLnN0cmluZ2lmeSBhcmdzfVwiXG5cbmdlbmVyaWMgZGVidWcsIEdyYXBoLmlzVHlwZSwgVGFsb3MuaXNUeXBlLCBUeXBlLmlzQW55LCAoIGdyYXBoLCB0YWxvcywgdHJhbnNmb3JtICkgLT5cbiAgX2RlYnVnIGdyYXBoLCB0YWxvcywgdHJhbnNmb3JtXG5cbmdlbmVyaWMgZGVidWcsIEdyYXBoLmlzVHlwZSwgKCBuZWdhdGUgVGFsb3MuaXNUeXBlICksICggZ3JhcGgsIHRyYW5zZm9ybSApIC0+XG4gIF9kZWJ1ZyBncmFwaCwgVGFsb3MuY3JlYXRlKCksIHRyYW5zZm9ybVxuXG5cbl9kZWJ1ZyA9ICggZ3JhcGgsIHRhbG9zLCB0cmFuc2Zvcm0gKSAtPlxuICBjb25zb2xlLmxvZyBcInN0YXJ0aW5nIHN0ZXBcIiwgeyBncmFwaCwgdGFsb3MsIHRyYW5zZm9ybSB9XG5cbiAgdmVydGV4ID0gbWF0Y2hWZXJ0ZXggZ3JhcGgsIHRhbG9zXG4gIGlmIHRhbG9zLmhhbHRlZFxuICAgIGNvbnNvbGUuZXJyb3IgXCJlbmNvdW50ZXJlZCBlcnJvciBtYXRjaGluZyB2ZXJ0ZXhcIiwgdGFsb3MuZXJyb3IuZXJyb3IsIHRhbG9zXG4gICAgcmV0dXJuIHRhbG9zXG4gIGVsc2VcbiAgICBjb25zb2xlLmxvZyBcInZlcnRleCBtYXRjaGVkXCIsIHsgdmVydGV4LCB0YWxvcyB9XG4gIFxuICBlZGdlID0gYXdhaXQgbWF0Y2hFZGdlIHZlcnRleCwgdGFsb3MsIHRyYW5zZm9ybVxuICBpZiAhZWRnZT9cbiAgICBjb25zb2xlLmxvZyBcIm5vIGVkZ2UgbWF0Y2gsIGlnbm9yaW5nIHRyYW5zZm9ybVwiXG4gICAgcmV0dXJuIHRhbG9zXG4gIGlmIHRhbG9zLmhhbHRlZFxuICAgIGNvbnNvbGUuZXJyb3IgXCJlbmNvdW50ZXJlZCBlcnJvciBtYXRjaGluZyBlZGdlXCIsIHRhbG9zLmVycm9yLmVycm9yLCB0YWxvc1xuICAgIHJldHVybiB0YWxvc1xuICBlbHNlXG4gICAgY29uc29sZS5sb2cgXCJlZGdlIG1hdGNoZWRcIiwgeyBlZGdlLCB0YWxvcyB9XG5cbiAgYXdhaXQgcnVuIGVkZ2UsIHRhbG9zLCB0cmFuc2Zvcm1cbiAgaWYgdGFsb3MuaGFsdGVkXG4gICAgY29uc29sZS5lcnJvciBcImVuY291bnRlcmVkIGVycm9yIHJ1bm5pbmcgZWRnZSBmdW5jdGlvblwiLCB0YWxvcy5lcnJvci5lcnJvciwgdGFsb3NcbiAgICByZXR1cm4gdGFsb3NcbiAgZWxzZVxuICAgIGNvbnNvbGUubG9nIFwiZWRnZSBmdW5jdGlvbiBjb21wbGV0ZVwiLCB7IHRhbG9zIH1cblxuICBhd2FpdCBtb3ZlIGVkZ2UsIHRhbG9zLCB0cmFuc2Zvcm1cbiAgaWYgdGFsb3MuaGFsdGVkXG4gICAgY29uc29sZS5lcnJvciBcImVuY291bnRlcmVkIGVycm9yIHJ1bm5pbmcgbW92ZSBmdW5jdGlvblwiLCB0YWxvcy5lcnJvci5lcnJvciwgdGFsb3NcbiAgICByZXR1cm4gdGFsb3NcbiAgZWxzZVxuICAgIGNvbnNvbGUubG9nIFwidGFsb3MgbW92ZSBjb21wbGV0ZVwiLCB7IHRhbG9zIH1cblxuICB0YWxvc1xuXG5cblxuZXhwb3J0IHtcbiAgc3RlcFxuICBkZWJ1Z1xufSJdLCJzb3VyY2VSb290IjoiIn0=
//# sourceURL=src/stable/async.coffee